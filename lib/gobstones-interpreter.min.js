!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("gobstones-interpreter",[],e):"object"==typeof exports?exports["gobstones-interpreter"]=e():t["gobstones-interpreter"]=e()}(this,function(){return function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=9)}([function(t,e,r){"use strict";function n(t){return'la palabra clave "'+t+'"'}function i(t,e,r){return 0===t?"ningún "+e:1===t?"un "+e:t.toString()+" "+r}function o(t){return f[h][t]}function a(t,e){if(!(t in f))throw Error("Invlid language code: "+t);var r=h;h=t;try{return e()}finally{h=r}}function s(t){return o("<position>")(t.filename,t.line,t.column)}Object.defineProperty(e,"__esModule",{value:!0}),e.i18n=o,e.i18nWithLanguage=a,e.i18nPosition=s;var u={definition:"una definición (de programa, función, procedimiento, o tipo)",pattern:'un patrón (comodín "_", constructor aplicado a variables, o tupla)',statement:"un comando",expression:"una expresión","procedure call":"una invocación a un procedimiento","field name":"el nombre de un campo",T_EOF:"el final del archivo",T_NUM:"un número",T_STRING:"una cadena (string)",T_UPPERID:"un identificador con mayúsculas",T_LOWERID:"un identificador con minúsculas",T_PROGRAM:n("program"),T_INTERACTIVE:n("interactive"),T_PROCEDURE:n("procedure"),T_FUNCTION:n("function"),T_RETURN:n("return"),T_IF:n("if"),T_THEN:n("then"),T_ELSE:n("else"),T_REPEAT:n("repeat"),T_FOREACH:n("foreach"),T_IN:n("in"),T_WHILE:n("while"),T_SWITCH:n("switch"),T_TO:n("to"),T_LET:n("let"),T_NOT:n("not"),T_DIV:n("div"),T_MOD:n("mod"),T_TYPE:n("type"),T_IS:n("is"),T_RECORD:n("record"),T_VARIANT:n("variant"),T_CASE:n("case"),T_FIELD:n("field"),T_UNDERSCORE:'un guión bajo ("_")',T_LPAREN:'un paréntesis izquierdo ("(")',T_RPAREN:'un paréntesis derecho (")")',T_LBRACE:'una llave izquierda ("{")',T_RBRACE:'una llave derecha ("}")',T_LBRACK:'un corchete izquierdo ("[")',T_RBRACK:'un corchete derecho ("]")',T_COMMA:'una coma (",")',T_SEMICOLON:'un punto y coma (";")',T_RANGE:'un separador de rango ("..")',T_GETS:'una flecha hacia la izquierda ("<-")',T_PIPE:'una barra vertical ("|")',T_ARROW:'una flecha ("->")',T_ASSIGN:'un operador de asignación (":=")',T_EQ:'una comparación por igualdad ("==")',T_NE:'una comparación por desigualdad ("/=")',T_LE:'un menor o igual ("<=")',T_GE:'un mayor o igual (">=")',T_LT:'un menor estricto ("<")',T_GT:'un mayor estricto (">")',T_AND:'el "y" lógico ("&&")',T_OR:'el "o" lógico ("||")',T_CONCAT:'el operador de concatenación de listas ("++")',T_PLUS:'el operador de suma ("+")',T_MINUS:'el operador de resta ("-")',T_TIMES:'el operador de producto ("*")',T_POW:'el operador de potencia ("^")',LocalVariable:"variable",LocalIndex:"índice",LocalParameter:"parámetro",V_Integer:"un número",V_String:"una cadena",V_Tuple:"una tupla",V_List:"una lista",V_Structure:"una estructura","errmsg:unclosed-multiline-comment":"El comentario se abre pero nunca se cierra.","errmsg:unclosed-string-constant":"La comilla que abre no tiene una comilla que cierra correspondiente.","errmsg:numeric-constant-should-not-have-leading-zeroes":"Las constantes numéricas no se pueden escribir con ceros a la izquierda.","errmsg:identifier-must-start-with-alphabetic-character":"Los identificadores deben empezar con un caracter alfabético (a...z,A...Z).","errmsg:unknown-token":function(t){return'Símbolo desconocido en la entrada: "'+t+'".'},"warning:empty-pragma":"Directiva pragma vacía.","warning:unknown-pragma":function(t){return'Directiva pragma desconocida: "'+t+'".'},"errmsg:empty-source":"El programa está vacío.","errmsg:expected-but-found":function(t,e){return"Se esperaba "+t+".\nSe encontró: "+e+"."},"errmsg:pattern-tuple-cannot-be-singleton":"El patrón para una tupla no puede tener una sola componente. Las tuplas tienen 0, 2, 3, o más componentes, pero no 1.","errmsg:assignment-tuple-cannot-be-singleton":"La asignación a una tupla no puede constar de una sola componente. Las tuplas tienen 0, 2, 3, o más componentes, pero no 1.","errmsg:operators-are-not-associative":function(t,e){return"La expresión usa "+t+" y "+e+", pero estos operadores no se pueden asociar. Quizás faltan paréntesis."},"errmsg:obsolete-tuple-assignment":'Se esperaba un comando pero se encontró un paréntesis izquierdo. Nota: la sintaxis de asignación de tuplas "(x1, ..., xN) := y" está obsoleta. Usar "let (x1, ..., xN) := y".',"errmsg:program-already-defined":function(t,e){return"Ya había un programa definido en "+t+".\nNo se puede definir un programa en "+e+"."},"errmsg:procedure-already-defined":function(t,e,r){return'El procedimiento "'+t+'" está definido dos veces: en '+e+" y en "+r+"."},"errmsg:function-already-defined":function(t,e,r){return'La función "'+t+'" está definida dos veces: en '+e+" y en "+r+"."},"errmsg:type-already-defined":function(t,e,r){return'El tipo "'+t+'" está definido dos veces: en '+e+" y en "+r+"."},"errmsg:constructor-already-defined":function(t,e,r){return'El constructor "'+t+'" está definido dos veces: en '+e+" y en "+r+"."},"errmsg:repeated-field-name":function(t,e){return'El campo "'+e+'" no puede estar repetido para el constructor "'+t+'".'},"errmsg:function-and-field-cannot-have-the-same-name":function(t,e,r){return'El nombre "'+t+'" se usa para una función en '+e+" y para un campo en "+r+"."},"errmsg:source-should-have-a-program-definition":'El código debe tener una definición de "program { ... }".',"errmsg:procedure-should-not-have-return":function(t){return'El procedimiento "'+t+'" no debería tener un comando "return".'},"errmsg:function-should-have-return":function(t){return'La función "'+t+'" debería tener un comando "return".'},"errmsg:return-statement-not-allowed-here":'El comando "return" solo puede aparecer como el último comando de una función o como el último comando del programa.',"errmsg:local-name-conflict":function(t,e,r,n,i){return'Conflicto de nombres: "'+t+'" se usa dos veces: como '+e+" en "+r+", y como "+n+" en "+i+"."},"errmsg:repeated-variable-in-tuple-assignment":function(t){return'La variable "'+t+'" está repetida en la asignación de tuplas.'},"errmsg:constructor-used-as-procedure":function(t,e){return'El procedimiento "'+t+'" no está definido. El nombre "'+t+'" es el nombre de un constructor del tipo "'+e+'".'},"errmsg:undefined-procedure":function(t){return'El procedimiento "'+t+'" no está definido.'},"errmsg:undefined-function":function(t){return'La función "'+t+'" no está definida.'},"errmsg:procedure-arity-mismatch":function(t,e,r){return'El procedimiento "'+t+'" espera recibir '+u["<n>-parameters"](e)+" pero se lo invoca con "+u["<n>-arguments"](r)+"."},"errmsg:function-arity-mismatch":function(t,e,r){return'La función "'+t+'" espera recibir '+u["<n>-parameters"](e)+" pero se la invoca con "+u["<n>-arguments"](r)+"."},"errmsg:structure-pattern-arity-mismatch":function(t,e,r){return'El constructor "'+t+'" tiene '+u["<n>-fields"](e)+" pero el patrón tiene "+u["<n>-parameters"](r)+"."},"errmsg:type-used-as-constructor":function(t,e){var r=void 0;return r=0===e.length?"(no tiene constructores).":1===e.length?"(tiene un constructor: "+e[0]+").":"(sus constructores son: "+e.join(", ")+").",'El constructor "'+t+'" no está definido. El nombre "'+t+'" es el nombre de un tipo '+r},"errmsg:procedure-used-as-constructor":function(t){return'El constructor "'+t+'" no está definido. El nombre "'+t+'" es el nombre de un procedimiento.'},"errmsg:undeclared-constructor":function(t){return'El constructor "'+t+'" no está definido.'},"errmsg:wildcard-pattern-should-be-last":'El comodín "_" tiene que ser la última rama del switch.',"errmsg:structure-pattern-repeats-constructor":function(t){return'Hay dos ramas distintas para el constructor "'+t+'".'},"errmsg:structure-pattern-repeats-tuple-arity":function(t){return"Hay dos ramas distintas para las tuplas de "+t.toString()+" componentes."},"errmsg:structure-pattern-repeats-timeout":"Hay dos ramas distintas para el TIMEOUT.","errmsg:pattern-does-not-match-type":function(t,e){return'Los patrones tienen que ser todos del mismo tipo. El patrón debería ser de tipo "'+t+'" pero es de tipo "'+e+'".'},"errmsg:patterns-in-interactive-program-must-be-events":'Los patrones de un "interactive program" deben ser eventos.',"errmsg:patterns-in-switch-must-not-be-events":'Los patrones de un "switch" no pueden ser eventos.',"errmsg:structure-construction-repeated-field":function(t,e){return'El campo "'+e+'" está repetido en la instanciación del constructor "'+t+'".'},"errmsg:structure-construction-invalid-field":function(t,e){return'El campo "'+e+'" no es un campo válido para el constructor "'+t+'".'},"errmsg:structure-construction-missing-field":function(t,e){return'Falta darle valor al campo "'+e+'" del constructor "'+t+'".'},"errmsg:structure-construction-cannot-be-an-event":function(t){return'El constructor "'+t+'" corresponde a un evento, y solamente se puede manejar implícitamente en un programa interactivo (el usuario no puede construir instancias).'},"errmsg:undefined-variable":function(t){return'La variable "'+t+'" no está definida.'},"errmsg:too-few-arguments":function(t){return'Faltan argumentos para "'+t+'".'},"errmsg:expected-structure-but-got":function(t,e){return'Se esperaba una estructura construida con el constructor "'+t+'", pero se recibió '+e+"."},"errmsg:expected-constructor-but-got":function(t,e){return'Se esperaba una estructura construida con el constructor "'+t+'", pero el constructor recibido es '+e+'".'},"errmsg:incompatible-types-on-assignment":function(t,e,r){return'La variable "'+t+'" contenía un valor de tipo '+e+", no se le puede asignar un valor de tipo "+r+'".'},"errmsg:incompatible-types-on-list-creation":function(t,e,r){return"Todos los elementos de una lista deben ser del mismo tipo. Los elementos son de tipo "+e+", pero el elemento en la posición "+t.toString()+" es de tipo "+r+"."},"errmsg:incompatible-types-on-structure-update":function(t,e,r){return'El campo "'+t+'" es de tipo '+e+". No se lo puede actualizar con un valor de tipo "+r+"."},"errmsg:expected-tuple-value-but-got":function(t){return"Se esperaba una tupla pero se recibió un valor de tipo "+t+"."},"errmsg:tuple-component-out-of-bounds":function(t,e){return"Índice fuera de rango. La tupla es de tamaño "+t.toString()+" y el índice es "+e.toString()+"."},"errmsg:expected-structure-value-but-got":function(t){return"Se esperaba una estructura pero se recibió un valor de tipo "+t+"."},"errmsg:structure-field-not-present":function(t,e){return'La estructura no tiene un campo "'+e+'". Los campos son: ['+t.join(", ")+"]."},"errmsg:primitive-does-not-exist":function(t){return'La operación primitiva "'+t+'" no existe o no está disponible.'},"errmsg:primitive-arity-mismatch":function(t,e,r){return'La operación "'+t+'" espera recibir '+u["<n>-parameters"](e)+" pero se la invoca con "+u["<n>-arguments"](r)+"."},"errmsg:primitive-argument-type-mismatch":function(t,e,r,n){return"El parámetro #"+e.toString()+' de la operación "'+t+'" debería ser de tipo '+r+" pero el argumento es de tipo "+n+"."},"errmsg:expected-value-of-type-but-got":function(t,e){return"Se esperaba un valor de tipo "+t+" pero se recibió un valor de tipo "+e+"."},"errmsg:expected-value-of-some-type-but-got":function(t,e){return"Se esperaba un valor de alguno de los siguientes tipos: "+t.join(", ")+"; pero se recibió un valor de tipo "+e+"."},"errmsg:expected-values-to-have-compatible-types":function(t,e){return"Los tipos de los valores deben ser compatibles, pero uno es de tipo "+t+" y el otro es de tipo "+e+"."},"errmsg:switch-does-not-match":"El valor analizado no coincide con ninguna de las ramas del switch.","errmsg:cannot-divide-by-zero":"No se puede dividir por cero.","errmsg:list-cannot-be-empty":"La lista no puede ser vacía.","errmsg:timeout":function(t){return"La ejecución del programa demoró más de "+t.toString()+"ms."},"errmsg:cannot-move-to":function(t){return"No se puede mover hacia la dirección "+t+": cae afuera del tablero."},"errmsg:cannot-remove-stone":function(t){return"No se puede sacar una bolita de color "+t+": no hay bolitas de ese color."},"TYPE:Integer":"Number","TYPE:String":"String","TYPE:Tuple":"Tuple","TYPE:List":"List","TYPE:Event":"Event","CONS:INIT":"INIT","CONS:TIMEOUT":"TIMEOUT","TYPE:Bool":"Bool","CONS:False":"False","CONS:True":"True","TYPE:Color":"Color","CONS:Color0":"Azul","CONS:Color1":"Negro","CONS:Color2":"Rojo","CONS:Color3":"Verde","TYPE:Dir":"Dir","CONS:Dir0":"Norte","CONS:Dir1":"Este","CONS:Dir2":"Sur","CONS:Dir3":"Oeste","PRIM:PutStone":"Poner","PRIM:RemoveStone":"Sacar","PRIM:Move":"Mover","PRIM:GoToEdge":"IrAlBorde","PRIM:EmptyBoardContents":"VaciarTablero","PRIM:numStones":"nroBolitas","PRIM:anyStones":"hayBolitas","PRIM:canMove":"puedeMover","PRIM:next":"siguiente","PRIM:prev":"previo","PRIM:opposite":"opuesto","PRIM:minBool":"minBool","PRIM:maxBool":"maxBool","PRIM:minColor":"minColor","PRIM:maxColor":"maxColor","PRIM:minDir":"minDir","PRIM:maxDir":"maxDir","PRIM:head":"primero","PRIM:tail":"resto","PRIM:init":"ultimo","PRIM:last":"comienzo","<alternative>":function(t){return"alguna de las siguientes alternativas:\n"+t.map(function(t){return"  "+t}).join("\n")},"<position>":function(t,e,r){return t+":"+e.toString()+":"+r.toString()},"<n>-parameters":function(t){return i(t,"parámetro","parámetros")},"<n>-arguments":function(t){return i(t,"argumento","argumentos")},"<n>-fields":function(t){return i(t,"campo","campos")},"<pattern-type>":function(t){return"Event"===t?"evento del programa interactivo":"_TUPLE_"===t.substring(0,7)?"tupla de "+t.substring(7)+" componentes":t}},c={};for(var l in u)c[l]=u[l];c["CONS:Dir0"]="North",c["CONS:Dir1"]="East",c["CONS:Dir2"]="South",c["CONS:Dir3"]="West";var h="es",f={es:u,en:c}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.GbsRuntimeError=e.GbsSyntaxError=e.GbsWarning=e.GbsInterpreterException=void 0;var a=r(0),s=e.GbsInterpreterException=function(t){function e(t,r,o,s,u){n(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s,t.filename,t.row));return c.isGobstonesException=!0,c.startPos=t,c.endPos=r,c.reason=s,c.args=u,c.message=(0,a.i18n)(o+":"+s),u.length>0&&"function"==typeof c.message&&(c.message=c.message.apply(null,u)),c}return o(e,t),e}(Error);e.GbsWarning=function(t){function e(t,r,o,a){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,"warning",o,a))}return o(e,t),e}(s),e.GbsSyntaxError=function(t){function e(t,r,o,a){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,"errmsg",o,a))}return o(e,t),e}(s),e.GbsRuntimeError=function(t){function e(t,r,o,a){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,"errmsg",o,a))}return o(e,t),e}(s)},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t.split("\n")[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;e.push("  "+s)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e.join("\n")}function s(t){return null===t?"null":t instanceof Array?"[\n"+G(t).join(",\n")+"\n]":t instanceof l.Token?t.toString():Symbol.keyFor(t.tag).substring(2)+"(\n"+G(t.children).join(",\n")+"\n)"}Object.defineProperty(e,"__esModule",{value:!0}),e.ASTConstructorDeclaration=e.ASTFieldBinding=e.ASTExprFunctionCall=e.ASTExprStructureUpdate=e.ASTExprStructure=e.ASTExprTuple=e.ASTExprRange=e.ASTExprList=e.ASTExprConstantString=e.ASTExprConstantNumber=e.ASTExprVariable=e.ASTPatternTimeout=e.ASTPatternTuple=e.ASTPatternStructure=e.ASTPatternWildcard=e.ASTStmtProcedureCall=e.ASTStmtAssignTuple=e.ASTStmtAssignVariable=e.ASTSwitchBranch=e.ASTStmtSwitch=e.ASTStmtWhile=e.ASTStmtForeach=e.ASTStmtRepeat=e.ASTStmtIf=e.ASTStmtReturn=e.ASTStmtBlock=e.ASTDefType=e.ASTDefFunction=e.ASTDefProcedure=e.ASTDefInteractiveProgram=e.ASTDefProgram=e.ASTMain=e.ASTNode=e.N_ConstructorDeclaration=e.N_FieldBinding=e.N_SwitchBranch=e.N_ExprFunctionCall=e.N_ExprStructureUpdate=e.N_ExprStructure=e.N_ExprTuple=e.N_ExprRange=e.N_ExprList=e.N_ExprConstantString=e.N_ExprConstantNumber=e.N_ExprVariable=e.N_PatternTimeout=e.N_PatternTuple=e.N_PatternStructure=e.N_PatternWildcard=e.N_StmtProcedureCall=e.N_StmtAssignTuple=e.N_StmtAssignVariable=e.N_StmtSwitch=e.N_StmtWhile=e.N_StmtForeach=e.N_StmtRepeat=e.N_StmtIf=e.N_StmtReturn=e.N_StmtBlock=e.N_DefType=e.N_DefFunction=e.N_DefProcedure=e.N_DefInteractiveProgram=e.N_DefProgram=e.N_Main=void 0;var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=r(5),l=r(6),h=e.N_Main=Symbol.for("N_Main"),f=e.N_DefProgram=Symbol.for("N_DefProgram"),p=e.N_DefInteractiveProgram=Symbol.for("N_DefInteractiveProgram"),_=e.N_DefProcedure=Symbol.for("N_DefProcedure"),m=e.N_DefFunction=Symbol.for("N_DefFunction"),d=e.N_DefType=Symbol.for("N_DefType"),y=e.N_StmtBlock=Symbol.for("N_StmtBlock"),v=e.N_StmtReturn=Symbol.for("N_StmtReturn"),g=e.N_StmtIf=Symbol.for("N_StmtIf"),b=e.N_StmtRepeat=Symbol.for("N_StmtRepeat"),T=e.N_StmtForeach=Symbol.for("N_StmtForeach"),S=e.N_StmtWhile=Symbol.for("N_StmtWhile"),P=e.N_StmtSwitch=Symbol.for("N_StmtSwitch"),k=e.N_StmtAssignVariable=Symbol.for("N_StmtAssignVariable"),w=e.N_StmtAssignTuple=Symbol.for("N_StmtAssignTuple"),E=e.N_StmtProcedureCall=Symbol.for("N_StmtProcedureCall"),I=e.N_PatternWildcard=Symbol.for("N_PatternWildcard"),N=e.N_PatternStructure=Symbol.for("N_PatternStructure"),R=e.N_PatternTuple=Symbol.for("N_PatternTuple"),x=e.N_PatternTimeout=Symbol.for("N_PatternTimeout"),C=e.N_ExprVariable=Symbol.for("N_ExprVariable"),O=e.N_ExprConstantNumber=Symbol.for("N_ExprConstantNumber"),A=e.N_ExprConstantString=Symbol.for("N_ExprConstantString"),L=e.N_ExprList=Symbol.for("N_ExprList"),F=e.N_ExprRange=Symbol.for("N_ExprRange"),D=e.N_ExprTuple=Symbol.for("N_ExprTuple"),M=e.N_ExprStructure=Symbol.for("N_ExprStructure"),V=e.N_ExprStructureUpdate=Symbol.for("N_ExprStructureUpdate"),B=e.N_ExprFunctionCall=Symbol.for("N_ExprFunctionCall"),j=e.N_SwitchBranch=Symbol.for("N_SwitchBranch"),U=e.N_FieldBinding=Symbol.for("N_FieldBinding"),W=e.N_ConstructorDeclaration=Symbol.for("N_ConstructorDeclaration"),G=void 0;G=function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var c=o.value;e.push(a(s(c)))}}catch(t){n=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(n)throw i}}return e};var q=e.ASTNode=function(){function t(e,r){if(o(this,t),this._tag=e,this._children=r,this._startPos=c.UnknownPosition,this._endPos=c.UnknownPosition,!(r instanceof Array))throw Error("The children of an ASTNode should be an array.")}return u(t,[{key:"toString",value:function(){return s(this)}},{key:"tag",get:function(){return this._tag}},{key:"children",get:function(){return this._children}},{key:"startPos",set:function(t){this._startPos=t},get:function(){return this._startPos}},{key:"endPos",set:function(t){this._endPos=t},get:function(){return this._endPos}}]),t}();e.ASTMain=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h,t))}return i(e,t),u(e,[{key:"definitions",get:function(){return this._children}}]),e}(q),e.ASTDefProgram=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f,[t]))}return i(e,t),u(e,[{key:"body",get:function(){return this.children[0]}}]),e}(q),e.ASTDefInteractiveProgram=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p,t))}return i(e,t),u(e,[{key:"branches",get:function(){return this.children}}]),e}(q),e.ASTDefProcedure=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,_,[t,r,i]))}return i(e,t),u(e,[{key:"name",get:function(){return this.children[0]}},{key:"parameters",get:function(){return this.children[1]}},{key:"body",get:function(){return this.children[2]}}]),e}(q),e.ASTDefFunction=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,m,[t,r,i]))}return i(e,t),u(e,[{key:"name",get:function(){return this.children[0]}},{key:"parameters",get:function(){return this.children[1]}},{key:"body",get:function(){return this.children[2]}}]),e}(q),e.ASTDefType=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d,[t,r]))}return i(e,t),u(e,[{key:"typeName",get:function(){return this._children[0]}},{key:"constructorDeclarations",get:function(){return this._children[1]}}]),e}(q),e.ASTStmtBlock=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,y,t))}return i(e,t),u(e,[{key:"statements",get:function(){return this.children}}]),e}(q),e.ASTStmtReturn=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,v,[t]))}return i(e,t),u(e,[{key:"result",get:function(){return this.children[0]}}]),e}(q),e.ASTStmtIf=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,g,[t,r,i]))}return i(e,t),u(e,[{key:"condition",get:function(){return this._children[0]}},{key:"thenBlock",get:function(){return this._children[1]}},{key:"elseBlock",get:function(){return this._children[2]}}]),e}(q),e.ASTStmtRepeat=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b,[t,r]))}return i(e,t),u(e,[{key:"times",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(q),e.ASTStmtForeach=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,T,[t,r,i]))}return i(e,t),u(e,[{key:"index",get:function(){return this._children[0]}},{key:"range",get:function(){return this._children[1]}},{key:"body",get:function(){return this._children[2]}}]),e}(q),e.ASTStmtWhile=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,S,[t,r]))}return i(e,t),u(e,[{key:"condition",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(q),e.ASTStmtSwitch=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,P,[t,r]))}return i(e,t),u(e,[{key:"subject",get:function(){return this._children[0]}},{key:"branches",get:function(){return this._children[1]}}]),e}(q),e.ASTSwitchBranch=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,j,[t,r]))}return i(e,t),u(e,[{key:"pattern",get:function(){return this._children[0]}},{key:"body",get:function(){return this._children[1]}}]),e}(q),e.ASTStmtAssignVariable=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,k,[t,r]))}return i(e,t),u(e,[{key:"variable",get:function(){return this._children[0]}},{key:"value",get:function(){return this._children[1]}}]),e}(q),e.ASTStmtAssignTuple=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,w,[t,r]))}return i(e,t),u(e,[{key:"variables",get:function(){return this._children[0]}},{key:"value",get:function(){return this._children[1]}}]),e}(q),e.ASTStmtProcedureCall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,E,[t,r]))}return i(e,t),u(e,[{key:"procedureName",get:function(){return this._children[0]}},{key:"args",get:function(){return this._children[1]}}]),e}(q),e.ASTPatternWildcard=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,I,[]))}return i(e,t),u(e,[{key:"parameters",get:function(){return[]}}]),e}(q),e.ASTPatternStructure=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,N,[t,r]))}return i(e,t),u(e,[{key:"constructorName",get:function(){return this._children[0]}},{key:"parameters",get:function(){return this._children[1]}}]),e}(q),e.ASTPatternTuple=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,R,t))}return i(e,t),u(e,[{key:"parameters",get:function(){return this._children}}]),e}(q),e.ASTPatternTimeout=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x,[t]))}return i(e,t),u(e,[{key:"parameters",get:function(){return[]}},{key:"timeout",get:function(){return parseInt(this._children[0].value,10)}}]),e}(q),e.ASTExprVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C,[t]))}return i(e,t),u(e,[{key:"variableName",get:function(){return this._children[0]}}]),e}(q),e.ASTExprConstantNumber=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,O,[t]))}return i(e,t),u(e,[{key:"number",get:function(){return this._children[0]}}]),e}(q),e.ASTExprConstantString=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,A,[t]))}return i(e,t),u(e,[{key:"string",get:function(){return this._children[0]}}]),e}(q),e.ASTExprList=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,L,t))}return i(e,t),u(e,[{key:"elements",get:function(){return this._children}}]),e}(q),e.ASTExprRange=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,F,[t,r,i]))}return i(e,t),u(e,[{key:"first",get:function(){return this._children[0]}},{key:"second",get:function(){return this._children[1]}},{key:"last",get:function(){return this._children[2]}}]),e}(q),e.ASTExprTuple=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,D,t))}return i(e,t),u(e,[{key:"elements",get:function(){return this.children}}]),e}(q),e.ASTExprStructure=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,M,[t,r]))}return i(e,t),u(e,[{key:"fieldNames",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this.fieldBindings[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.fieldName.value)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}},{key:"constructorName",get:function(){return this._children[0]}},{key:"fieldBindings",get:function(){return this._children[1]}}]),e}(q),e.ASTExprStructureUpdate=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,V,[t,r,i]))}return i(e,t),u(e,[{key:"fieldNames",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this.fieldBindings[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.fieldName.value)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}},{key:"constructorName",get:function(){return this._children[0]}},{key:"original",get:function(){return this._children[1]}},{key:"fieldBindings",get:function(){return this._children[2]}}]),e}(q),e.ASTExprFunctionCall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,B,[t,r]))}return i(e,t),u(e,[{key:"functionName",get:function(){return this._children[0]}},{key:"args",get:function(){return this._children[1]}}]),e}(q),e.ASTFieldBinding=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,U,[t,r]))}return i(e,t),u(e,[{key:"fieldName",get:function(){return this._children[0]}},{key:"value",get:function(){return this._children[1]}}]),e}(q),e.ASTConstructorDeclaration=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,W,[t,r]))}return i(e,t),u(e,[{key:"constructorName",get:function(){return this._children[0]}},{key:"fieldNames",get:function(){return this._children[1]}}]),e}(q)},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,r,n){throw new j.GbsRuntimeError(t,e,r,n)}function o(){return[(0,V.i18n)("CONS:False"),(0,V.i18n)("CONS:True")]}function a(){return[(0,V.i18n)("CONS:Color0"),(0,V.i18n)("CONS:Color1"),(0,V.i18n)("CONS:Color2"),(0,V.i18n)("CONS:Color3")]}function s(){return[(0,V.i18n)("CONS:Dir0"),(0,V.i18n)("CONS:Dir1"),(0,V.i18n)("CONS:Dir2"),(0,V.i18n)("CONS:Dir3")]}function u(){return[(0,V.i18n)("CONS:INIT"),(0,V.i18n)("CONS:TIMEOUT")].concat(U)}function c(t,e){return t.indexOf(e)}function l(t,e){return t[e]}function h(t){return l(s(),(c(s(),t)+2)%4)}function f(t){return l(s(),(c(s(),t)+1)%4)}function p(t){return l(s(),(c(s(),t)+3)%4)}function _(t){return l(a(),(c(a(),t)+1)%4)}function m(t){return l(a(),(c(a(),t)+3)%4)}function d(t){return t?new B.ValueStructure((0,V.i18n)("TYPE:Bool"),(0,V.i18n)("CONS:True"),{}):new B.ValueStructure((0,V.i18n)("TYPE:Bool"),(0,V.i18n)("CONS:False"),{})}function y(t){return t.constructorName===(0,V.i18n)("CONS:True")}function v(t){return new B.ValueStructure((0,V.i18n)("TYPE:Color"),t,{})}function g(t){return t.constructorName}function b(t){return new B.ValueStructure((0,V.i18n)("TYPE:Dir"),t,{})}function T(t){return t.constructorName}function S(t,e,r,n){}function P(t){return null!==(0,B.joinTypes)(t.type(),q)}function k(t){return null!==(0,B.joinTypes)(t.type(),Y)}function w(t){return null!==(0,B.joinTypes)(t.type(),H)}function E(t){return null!==(0,B.joinTypes)(t.type(),K)}function I(t){if(k(t))return y(t)?1:0;if(w(t))return c(a(),g(t));if(E(t))return c(s(),T(t));throw Error("Value should be Bool, Color or Dir.")}function N(t,e){return d(P(t)?t.le(e):I(t)<=I(e))}function R(t,e){return d(P(t)?t.ge(e):I(t)>=I(e))}function x(t,e){return d(P(t)?t.lt(e):I(t)<I(e))}function C(t,e){return d(P(t)?t.gt(e):I(t)>I(e))}function O(t){if(P(t))return t.add(new B.ValueInteger(1));if(k(t))return d(y(t)?!1:!0);if(w(t))return v(_(g(t)));if(E(t))return b(f(T(t)));throw Error("genericNext: value has no next.")}function A(t){if(P(t))return t.sub(new B.ValueInteger(1));if(k(t))return d(y(t)?!1:!0);if(w(t))return v(m(g(t)));if(E(t))return b(p(T(t)));throw Error("genericPrev: value has no prev.")}function L(t){if(P(t))return t.negate();if(k(t))return d(!y(t));if(E(t))return b(h(T(t)));throw Error("genericOpposite: value has no opposite.")}function F(t,e,r,n){var o=!0,a=!1,s=void 0;try{for(var u,c=n[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(null!==(0,B.joinTypes)(r.type(),l))return}}catch(t){a=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}var h=[],f=!0,p=!1,_=void 0;try{for(var m,d=n[Symbol.iterator]();!(f=(m=d.next()).done);f=!0){var y=m.value;h.push(y.toString())}}catch(t){p=!0,_=t}finally{try{!f&&d.return&&d.return()}finally{if(p)throw _}}i(t,e,"expected-value-of-some-type-but-got",[h,r.type().toString()])}function D(t,e,r,n){null===(0,B.joinTypes)(r.type(),n.type())&&i(t,e,"expected-values-to-have-compatible-types",[r.type().toString(),n.type().toString()])}Object.defineProperty(e,"__esModule",{value:!0}),e.RuntimePrimitives=e.TYPES_WITH_ORDER=e.TYPES_WITH_OPPOSITE=e.RuntimeState=void 0;var M=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.boolFromValue=y;var V=r(0),B=r(4),j=r(1),U=function(){var t=["","CTRL_","ALT_","SHIFT_","CTRL_ALT_","CTRL_SHIFT_","ALT_SHIFT_","CTRL_ALT_SHIFT_"],e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],r=["SPACE","ENTER","TAB","BACKSPACE","DELETE","ESCAPE"],n=["PLUS","MINUS","ASTERISK","SLASH","EQUALS","L_PARENT","R_PARENT","L_BRACKET","R_BRACKET","L_ANGLEBR","R_ANGLEBR"],i=["ARROW_LEFT","ARROW_RIGHT","ARROW_UP","ARROW_DOWN"],o=e.concat(r).concat(n).concat(i),a=[],s=!0,u=!1,c=void 0;try{for(var l,h=t[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var f=l.value,p=!0,_=!1,m=void 0;try{for(var d,y=o[Symbol.iterator]();!(p=(d=y.next()).done);p=!0){var v=d.value;a.push("K_"+f+v)}}catch(t){_=!0,m=t}finally{try{!p&&y.return&&y.return()}finally{if(_)throw m}}}}catch(t){u=!0,c=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw c}}return a}(),W=(e.RuntimeState=function(){function t(){n(this,t),this._width=11,this._height=7,this._board=[];for(var e=0;e<this._width;e++){for(var r=[],i=0;i<this._height;i++)r.push(this._emptyCell());this._board.push(r)}this._head={x:0,y:0}}return M(t,[{key:"clone",value:function(){var e=new t;e._width=this._width,e._height=this._height,e._board=[];for(var r=0;r<this._width;r++){for(var n=[],i=0;i<this._height;i++){var o={},s=!0,u=!1,c=void 0;try{for(var l,h=a()[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var f=l.value;o[f]=this._board[r][i][f]}}catch(t){u=!0,c=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw c}}n.push(o)}e._board.push(n)}return e._head={x:this._head.x,y:this._head.y},e}},{key:"dump",value:function(){var t={};t.width=this._width,t.height=this._height,t.head=[this._head.x,this._head.y],t.board=[];for(var e=0;e<this._width;e++){for(var r=[],n=0;n<this._height;n++){var i={};i.a=this._board[e][n][(0,V.i18n)("CONS:Color0")].asNumber(),i.n=this._board[e][n][(0,V.i18n)("CONS:Color1")].asNumber(),i.r=this._board[e][n][(0,V.i18n)("CONS:Color2")].asNumber(),i.v=this._board[e][n][(0,V.i18n)("CONS:Color3")].asNumber(),r.push(i)}t.board.push(r)}return t}},{key:"load",value:function(t){this._width=t.width,this._height=t.height,this._head.x=t.head[0],this._head.y=t.head[1];for(var e=0;e<this._width;e++)for(var r=0;r<this._height;r++){var n=t.board[e][r];this._board[e][r][(0,V.i18n)("CONS:Color0")]=new B.ValueInteger(n.a),this._board[e][r][(0,V.i18n)("CONS:Color1")]=new B.ValueInteger(n.n),this._board[e][r][(0,V.i18n)("CONS:Color2")]=new B.ValueInteger(n.r),this._board[e][r][(0,V.i18n)("CONS:Color3")]=new B.ValueInteger(n.v)}}},{key:"putStone",value:function(t){var e=this._board[this._head.x][this._head.y][t];e=e.add(new B.ValueInteger(1)),this._board[this._head.x][this._head.y][t]=e}},{key:"removeStone",value:function(t){var e=this._board[this._head.x][this._head.y][t];if(e.le(new B.ValueInteger(0)))throw Error("Cannot remove stone.");e=e.sub(new B.ValueInteger(1)),this._board[this._head.x][this._head.y][t]=e}},{key:"numStones",value:function(t){return this._board[this._head.x][this._head.y][t]}},{key:"move",value:function(t){if(!this.canMove(t))throw Error("Cannot move.");var e=this._deltaForDirection(t);this._head.x+=e[0],this._head.y+=e[1]}},{key:"goToEdge",value:function(t){if(t===(0,V.i18n)("CONS:Dir0"))this._head.y=this._height-1;else if(t===(0,V.i18n)("CONS:Dir1"))this._head.x=this._width-1;else if(t===(0,V.i18n)("CONS:Dir2"))this._head.y=0;else{if(t!==(0,V.i18n)("CONS:Dir3"))throw Error("Invalid direction: "+t);this._head.x=0}}},{key:"emptyBoardContents",value:function(){for(var t=0;t<this._width;t++)for(var e=0;e<this._height;e++)this._board[t][e]=this._emptyCell()}},{key:"canMove",value:function(t){var e=this._deltaForDirection(t),r=this._head.x+e[0],n=this._head.y+e[1];return 0<=r&&r<this._width&&0<=n&&n<this._height}},{key:"_deltaForDirection",value:function(t){var e=void 0;if(t===(0,V.i18n)("CONS:Dir0"))e=[0,1];else if(t===(0,V.i18n)("CONS:Dir1"))e=[1,0];else if(t===(0,V.i18n)("CONS:Dir2"))e=[0,-1];else{if(t!==(0,V.i18n)("CONS:Dir3"))throw Error("Invalid direction: "+t);e=[-1,0]}return e}},{key:"_emptyCell",value:function(){var t={},e=!0,r=!1,n=void 0;try{for(var i,o=a()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){t[i.value]=new B.ValueInteger(0)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t}}]),t}(),function(){function t(e,r,i){n(this,t),this._argumentTypes=e,this._argumentValidator=r,this._implementation=i}return M(t,[{key:"nargs",value:function(){return this._argumentTypes.length}},{key:"call",value:function(t,e){return this._implementation.apply(null,[t].concat(e))}},{key:"validateArguments",value:function(t,e,r,n){this._argumentValidator(t,e,r,n)}},{key:"argumentTypes",get:function(){return this._argumentTypes}}]),t}()),G=new B.TypeAny,q=new B.TypeInteger,J=new B.TypeString,Y=new B.TypeStructure((0,V.i18n)("TYPE:Bool"),{}),z=new B.TypeList(new B.TypeAny),H=new B.TypeStructure((0,V.i18n)("TYPE:Color"),{}),K=new B.TypeStructure((0,V.i18n)("TYPE:Dir"),{}),Z=e.TYPES_WITH_OPPOSITE=[q,Y,K],Q=e.TYPES_WITH_ORDER=[q,Y,H,K];e.RuntimePrimitives=function(){function t(){n(this,t),this._primitiveTypes={},this._primitiveProcedures={},this._primitiveFunctions={},this._primitiveTypes[(0,V.i18n)("TYPE:Bool")]={};var e=!0,r=!1,c=void 0;try{for(var l,h=o()[Symbol.iterator]();!(e=(l=h.next()).done);e=!0){var f=l.value;this._primitiveTypes[(0,V.i18n)("TYPE:Bool")][f]=[]}}catch(t){r=!0,c=t}finally{try{!e&&h.return&&h.return()}finally{if(r)throw c}}this._primitiveTypes[(0,V.i18n)("TYPE:Color")]={};var p=!0,_=!1,m=void 0;try{for(var P,k=a()[Symbol.iterator]();!(p=(P=k.next()).done);p=!0){var w=P.value;this._primitiveTypes[(0,V.i18n)("TYPE:Color")][w]=[]}}catch(t){_=!0,m=t}finally{try{!p&&k.return&&k.return()}finally{if(_)throw m}}this._primitiveTypes[(0,V.i18n)("TYPE:Dir")]={};var E=!0,I=!1,M=void 0;try{for(var j,U=s()[Symbol.iterator]();!(E=(j=U.next()).done);E=!0){var Y=j.value;this._primitiveTypes[(0,V.i18n)("TYPE:Dir")][Y]=[]}}catch(t){I=!0,M=t}finally{try{!E&&U.return&&U.return()}finally{if(I)throw M}}this._primitiveTypes[(0,V.i18n)("TYPE:Event")]={};var X=!0,$=!1,tt=void 0;try{for(var et,rt=u()[Symbol.iterator]();!(X=(et=rt.next()).done);X=!0){var nt=et.value;this._primitiveTypes[(0,V.i18n)("TYPE:Event")][nt]=[]}}catch(t){$=!0,tt=t}finally{try{!X&&rt.return&&rt.return()}finally{if($)throw tt}}this._primitiveProcedures[(0,V.i18n)("PRIM:PutStone")]=new W([H],S,function(t,e){return t.putStone(g(e)),null}),this._primitiveProcedures[(0,V.i18n)("PRIM:RemoveStone")]=new W([H],function(t,e,r,n){var o=g(n[0]);r.numStones(o).le(new B.ValueInteger(0))&&i(t,e,"cannot-remove-stone",[o])},function(t,e){return t.removeStone(g(e)),null}),this._primitiveProcedures[(0,V.i18n)("PRIM:Move")]=new W([K],function(t,e,r,n){var o=T(n[0]);r.canMove(o)||i(t,e,"cannot-move-to",[o])},function(t,e){return t.move(T(e)),null}),this._primitiveProcedures[(0,V.i18n)("PRIM:GoToEdge")]=new W([K],S,function(t,e){return t.goToEdge(T(e)),null}),this._primitiveProcedures[(0,V.i18n)("PRIM:EmptyBoardContents")]=new W([],S,function(t,e){return t.emptyBoardContents(),null}),this._primitiveProcedures._FAIL=new W([J],function(t,e,r,n){i(t,e,n[0].string,[])},function(t,e){return null}),this._primitiveFunctions._makeRange=new W([G,G],function(t,e,r,n){var i=n[0],o=n[1];D(t,e,i,o),F(t,e,i,Q),F(t,e,o,Q)},function(t,e,r){var n=e;if(y(C(n,r)))return new B.ValueList([]);for(var i=[];y(x(n,r));)i.push(n),n=O(n);return i.push(n),new B.ValueList(i)}),this._primitiveFunctions["&&"]=new W([G,G],S,function(t,e,r){throw Error('The function "&&" should never be called')}),this._primitiveFunctions["||"]=new W([G,G],S,function(t,e,r){throw Error('The function "||" should never be called')}),this._primitiveFunctions._makeRangeWithSecond=new W([G,G,G],function(t,e,r,n){var i=n[0],o=n[1],a=n[2];F(t,e,i,[q]),F(t,e,o,[q]),F(t,e,a,[q])},function(t,e,r,n){var i=n.sub(e);if(i.lt(new B.ValueInteger(1)))return new B.ValueList([]);for(var o=e,a=[];o.le(r);)a.push(o),o=o.add(i);return new B.ValueList(a)}),this._primitiveFunctions._unsafeListLength=new W([G],S,function(t,e){return new B.ValueInteger(e.length())}),this._primitiveFunctions._unsafeListNth=new W([G,G],S,function(t,e,r){return e.elements[r.asNumber()]}),this._primitiveFunctions[(0,V.i18n)("PRIM:numStones")]=new W([H],S,function(t,e){return t.numStones(g(e))}),this._primitiveFunctions[(0,V.i18n)("PRIM:anyStones")]=new W([H],S,function(t,e){return d(t.numStones(g(e)).gt(new B.ValueInteger(0)))}),this._primitiveFunctions[(0,V.i18n)("PRIM:canMove")]=new W([K],S,function(t,e){return d(t.canMove(T(e)))}),this._primitiveFunctions[(0,V.i18n)("PRIM:next")]=new W([G],function(t,e,r,n){F(t,e,n[0],Q)},function(t,e){return O(e)}),this._primitiveFunctions[(0,V.i18n)("PRIM:prev")]=new W([G],function(t,e,r,n){F(t,e,n[0],Q)},function(t,e){return A(e)}),this._primitiveFunctions[(0,V.i18n)("PRIM:opposite")]=new W([G],function(t,e,r,n){F(t,e,n[0],Q)},function(t,e){return L(e)}),this._primitiveFunctions[(0,V.i18n)("PRIM:minBool")]=new W([],S,function(t){return d(!1)}),this._primitiveFunctions[(0,V.i18n)("PRIM:maxBool")]=new W([],S,function(t){return d(!0)}),this._primitiveFunctions[(0,V.i18n)("PRIM:minColor")]=new W([],S,function(t){return v(a()[0])}),this._primitiveFunctions[(0,V.i18n)("PRIM:maxColor")]=new W([],S,function(t){return v(a()[a().length-1])}),this._primitiveFunctions[(0,V.i18n)("PRIM:minDir")]=new W([],S,function(t){return b(s()[0])}),this._primitiveFunctions[(0,V.i18n)("PRIM:maxDir")]=new W([],S,function(t){return b(s()[s().length-1])}),this._primitiveFunctions["+"]=new W([q,q],S,function(t,e,r){return e.add(r)}),this._primitiveFunctions["-"]=new W([q,q],S,function(t,e,r){return e.sub(r)}),this._primitiveFunctions["*"]=new W([q,q],S,function(t,e,r){return e.mul(r)}),this._primitiveFunctions.div=new W([q,q],function(t,e,r,n){n[1].eq(new B.ValueInteger(0))&&i(t,e,"cannot-divide-by-zero",[])},function(t,e,r){return e.div(r)}),this._primitiveFunctions.mod=new W([q,q],function(t,e,r,n){n[1].eq(new B.ValueInteger(0))&&i(t,e,"cannot-divide-by-zero",[])},function(t,e,r){return e.mod(r)}),this._primitiveFunctions["-(unary)"]=new W([G],function(t,e,r,n){F(t,e,n[0],Z)},function(t,e){return L(e)}),this._primitiveFunctions["=="]=new W([G,G],function(t,e,r,n){D(t,e,n[0],n[1])},function(t,e,r){return d(e.equal(r))}),this._primitiveFunctions["/="]=new W([G,G],function(t,e,r,n){D(t,e,n[0],n[1])},function(t,e,r){return d(!e.equal(r))}),this._primitiveFunctions["<="]=new W([G,G],function(t,e,r,n){var i=n[0],o=n[1];D(t,e,i,o),F(t,e,i,Q),F(t,e,o,Q)},function(t,e,r){return N(e,r)}),this._primitiveFunctions[">="]=new W([G,G],function(t,e,r,n){var i=n[0],o=n[1];D(t,e,i,o),F(t,e,i,Q),F(t,e,o,Q)},function(t,e,r){return R(e,r)}),this._primitiveFunctions["<"]=new W([G,G],function(t,e,r,n){var i=n[0],o=n[1];D(t,e,i,o),F(t,e,i,Q),F(t,e,o,Q)},function(t,e,r){return x(e,r)}),this._primitiveFunctions[">"]=new W([G,G],function(t,e,r,n){var i=n[0],o=n[1];D(t,e,i,o),F(t,e,i,Q),F(t,e,o,Q)},function(t,e,r){return C(e,r)}),this._primitiveFunctions["++"]=new W([z,z],function(t,e,r,n){D(t,e,n[0],n[1])},function(t,e,r){return e.append(r)}),this._primitiveFunctions[(0,V.i18n)("PRIM:head")]=new W([z],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.head()}),this._primitiveFunctions[(0,V.i18n)("PRIM:tail")]=new W([z],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.tail()}),this._primitiveFunctions[(0,V.i18n)("PRIM:init")]=new W([z],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.init()}),this._primitiveFunctions[(0,V.i18n)("PRIM:last")]=new W([z],function(t,e,r,n){0===n[0].length()&&i(t,e,"list-cannot-be-empty",[])},function(t,e){return e.last()})}return M(t,[{key:"types",value:function(){var t=[];for(var e in this._primitiveTypes)t.push(e);return t}},{key:"typeConstructors",value:function(t){if(!(t in this._primitiveTypes))throw Error("Not a primitive type: "+t);var e=[];for(var r in this._primitiveTypes[t])e.push(r);return e}},{key:"constructorFields",value:function(t,e){if(!(t in this._primitiveTypes))throw Error("Not a primitive type: "+t);if(!(e in this._primitiveTypes[t]))throw Error("Not a primitive constructor: "+e);return this._primitiveTypes[t][e]}},{key:"isOperation",value:function(t){return t in this._primitiveProcedures||t in this._primitiveFunctions}},{key:"getOperation",value:function(t){if(t in this._primitiveProcedures)return this._primitiveProcedures[t];if(t in this._primitiveFunctions)return this._primitiveFunctions[t];throw Error(t+" is not a primitive.")}},{key:"procedures",value:function(){var t=[];for(var e in this._primitiveProcedures)t.push(e);return t}},{key:"isProcedure",value:function(t){return t in this._primitiveProcedures}},{key:"functions",value:function(){var t=[];for(var e in this._primitiveFunctions)t.push(e);return t}},{key:"isFunction",value:function(t){return t in this._primitiveFunctions}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){return null===t||null===e?null:t.tag===h?e:e.tag===h?t:t.tag===f&&e.tag===f?t:t.tag===p&&e.tag===p?t:t.tag===_&&e.tag===_?k(t,e):t.tag===m&&e.tag===m?w(t,e):t.tag===d&&e.tag===d?E(t,e):null}function s(t){var e=[];for(var r in t)e.push(r);return e.sort()}Object.defineProperty(e,"__esModule",{value:!0}),e.ValueStructure=e.ValueList=e.ValueTuple=e.ValueString=e.ValueInteger=e.Value=e.V_Structure=e.V_List=e.V_Tuple=e.V_String=e.V_Integer=e.TypeStructure=e.TypeList=e.TypeTuple=e.TypeString=e.TypeInteger=e.TypeAny=void 0;var u=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.joinTypes=a;var c=r(0),l=r(10),h=Symbol.for("Ty_Any"),f=Symbol.for("Ty_Integer"),p=Symbol.for("Ty_String"),_=Symbol.for("Ty_Tuple"),m=Symbol.for("Ty_List"),d=Symbol.for("Ty_Structure"),y=function(){function t(e){o(this,t),this._tag=e}return u(t,[{key:"tag",get:function(){return this._tag}}]),t}(),v=e.TypeAny=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h))}return i(e,t),u(e,[{key:"toString",value:function(){return"?"}}]),e}(y),g=e.TypeInteger=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f))}return i(e,t),u(e,[{key:"toString",value:function(){return(0,c.i18n)("TYPE:Integer")}}]),e}(y),b=e.TypeString=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p))}return i(e,t),u(e,[{key:"toString",value:function(){return(0,c.i18n)("TYPE:String")}}]),e}(y),T=e.TypeTuple=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,_));return r._componentTypes=t,r}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._componentTypes[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return(0,c.i18n)("TYPE:Tuple")+"("+t.join(", ")+")"}},{key:"componentTypes",get:function(){return this._componentTypes}}]),e}(y),S=e.TypeList=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,m));return r._contentType=t,r}return i(e,t),u(e,[{key:"toString",value:function(){return(0,c.i18n)("TYPE:List")+"("+this._contentType.toString()+")"}},{key:"contentType",get:function(){return this._contentType}}]),e}(y),P=e.TypeStructure=function(t){function e(t,r){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d));return i._typeName=t,i._cases=r,i}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=s(this._cases)[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,u=this._cases[a],c=[],l=!0,h=!1,f=void 0;try{for(var p,_=s(u)[Symbol.iterator]();!(l=(p=_.next()).done);l=!0){var m=p.value;c.push(m+" <- "+u[m].toString())}}catch(t){h=!0,f=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw f}}var d=this._typeName+":"+a;0===c.length?t.push(d):t.push(d+"("+c.join(", ")+")")}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return 0===t.length?this._typeName:t.join(" + ")}},{key:"typeName",get:function(){return this._typeName}},{key:"cases",get:function(){return this._cases}}]),e}(y),k=void 0,w=void 0,E=void 0,I=void 0;k=function(t,e){if(t.componentTypes.length!==e.componentTypes.length)return null;for(var r=[],n=0;n<t.componentTypes.length;n++){var i=t.componentTypes[n],o=e.componentTypes[n],s=a(i,o);if(null===s)return null;r.push(s)}return new T(r)},w=function(t,e){var r=a(t.contentType,e.contentType);return null===r?null:new S(r)},E=function(t,e){function r(t,e){for(var r in t.cases)r in e.cases||(n[r]=t.cases[r])}if(t.typeName!==e.typeName)return null;var n={};r(t,e),r(e,t);for(var i in t.cases)if(i in e.cases){var o=I(t.cases[i],e.cases[i]);if(null===o)return null;n[i]=o}return new P(t.typeName,n)},I=function(t,e){function r(t,e){for(var r in t)if(!(r in e))throw Error("Join fields: structures built using the same constructor should have the same set of fields.")}r(t,e),r(e,t);var n={};for(var i in t){var o=t[i],s=e[i],u=a(o,s);if(null===u)return null;n[i]=u}return n};var N=e.V_Integer=Symbol.for("V_Integer"),R=e.V_String=Symbol.for("V_String"),x=e.V_Tuple=Symbol.for("V_Tuple"),C=e.V_List=Symbol.for("V_List"),O=e.V_Structure=Symbol.for("V_Structure"),A=e.Value=function(){function t(e){o(this,t),this._tag=e}return u(t,[{key:"type",value:function(){return new y("?",[])}},{key:"isInteger",value:function(){return!1}},{key:"isString",value:function(){return!1}},{key:"isTuple",value:function(){return!1}},{key:"isList",value:function(){return!1}},{key:"isStructure",value:function(){return!1}},{key:"isBoolean",value:function(){return!1}},{key:"tag",get:function(){return this._tag}}]),t}();e.ValueInteger=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,N));if("number"==typeof t)r._number=t.toString();else{if("string"!=typeof t)throw Error("Integer value must be constructed with an integer or a string");r._number=t}return r}return i(e,t),u(e,[{key:"isInteger",value:function(){return!0}},{key:"toString",value:function(){return this._number}},{key:"type",value:function(){return new g}},{key:"equal",value:function(t){return t.tag===N&&this.number===t.number}},{key:"add",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.add(n).toString())}},{key:"sub",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.subtract(n).toString())}},{key:"mul",value:function(t){var r=(0,l.Integer)(this._number),n=(0,l.Integer)(t._number);return new e(r.multiply(n).toString())}},{key:"div",value:function(t){var r=new e(0);if(this.gt(r)===t.gt(r)){var n=(0,l.Integer)(this.abs()._number),i=(0,l.Integer)(t.abs()._number);return new e(n.divide(i).toString())}var o=t.abs().sub(new e(1)),a=(0,l.Integer)(this.abs().add(o)._number),s=(0,l.Integer)(t.abs()._number);return new e(a.divide(s).negate().toString())}},{key:"mod",value:function(t){var e=this.div(t);return this.sub(e.mul(t))}},{key:"eq",value:function(t){return this.equal(t)}},{key:"ne",value:function(t){return!this.equal(t)}},{key:"le",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.leq(r)}},{key:"lt",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.lt(r)}},{key:"ge",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.geq(r)}},{key:"gt",value:function(t){var e=(0,l.Integer)(this._number),r=(0,l.Integer)(t._number);return e.gt(r)}},{key:"negate",value:function(){return new e((0,l.Integer)(this._number).negate().toString())}},{key:"abs",value:function(){return this.gt(new e(0))?this:this.negate()}},{key:"asNumber",value:function(){return parseInt(this._number,10)}},{key:"number",get:function(){return this._number}}]),e}(A),e.ValueString=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,R));return r._string=t,r}return i(e,t),u(e,[{key:"toString",value:function(){for(var t=['"'],e=0;e<this._string.length;e++){var r=this._string[e];switch(r){case'"':t.push("\\"),t.push('"');break;case"\\":t.push("\\"),t.push("\\");break;case"":t.push("\\"),t.push("a");break;case"\b":t.push("\\"),t.push("b");break;case"\f":t.push("\\"),t.push("f");break;case"\n":t.push("\\"),t.push("n");break;case"\r":t.push("\\"),t.push("r");break;case"\t":t.push("\\"),t.push("t");break;case"\v":t.push("\\"),t.push("v");break;default:t.push(r)}}return t.push('"'),t.join("")}},{key:"isString",value:function(){return!0}},{key:"equal",value:function(t){return t.tag===R&&this.string===t.string}},{key:"type",value:function(){return new b}},{key:"string",get:function(){return this._string}}]),e}(A),e.ValueTuple=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x));return r._components=t,r._type=r._inferType(),r}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._components[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return"("+t.join(", ")+")"}},{key:"size",value:function(){return this._components.length}},{key:"equal",value:function(t){if(t.tag!==x)return!1;if(this.components.length!==t.components.length)return!1;for(var e=0;e<this.components.length;e++)if(!this.components[e].equal(t.components[e]))return!1;return!0}},{key:"isTuple",value:function(){return!0}},{key:"type",value:function(){return this._type}},{key:"_inferType",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._components[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.type())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return new T(t)}},{key:"components",get:function(){return this._components}}]),e}(A),e.ValueList=function(t){function e(t){o(this,e);var r=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C));return r._elements=t,r._type=r._inferType(),r}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return"["+t.join(", ")+"]"}},{key:"equal",value:function(t){if(t.tag!==C)return!1;if(this.elements.length!==t.elements.length)return!1;for(var e=0;e<this.elements.length;e++)if(!this.elements[e].equal(t.elements[e]))return!1;return!0}},{key:"type",value:function(){return this._type}},{key:"isList",value:function(){return!0}},{key:"length",value:function(){return this._elements.length}},{key:"_inferType",value:function(){var t=new v,e=!0,r=!1,n=void 0;try{for(var i,o=this._elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){t=a(t,i.value.type())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return new S(t)}},{key:"append",value:function(t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=this.elements[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r.push(u)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}var c=!0,l=!1,h=void 0;try{for(var f,p=t.elements[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var _=f.value;r.push(_)}}catch(t){l=!0,h=t}finally{try{!c&&p.return&&p.return()}finally{if(l)throw h}}return new e(r)}},{key:"head",value:function(){return this.elements[0]}},{key:"tail",value:function(){for(var t=[],r=1;r<this.elements.length;r++)t.push(this.elements[r]);return new e(t)}},{key:"init",value:function(){for(var t=[],r=0;r<this.elements.length-1;r++)t.push(this.elements[r]);return new e(t)}},{key:"last",value:function(){return this.elements[this.elements.length-1]}},{key:"elements",get:function(){return this._elements}}]),e}(A),e.ValueStructure=function(t){function e(t,r,i){o(this,e);var a=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,O));return a._typeName=t,a._constructorName=r,a._fields=i,a}return i(e,t),u(e,[{key:"toString",value:function(){var t=[],e=this.fieldNames();if(0===e.length)return this._constructorName;var r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t.push(s+" <- "+this.fields[s].toString())}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return this._constructorName+"("+t.join(", ")+")"}},{key:"isStructure",value:function(){return!0}},{key:"isBoolean",value:function(){return this._typeName===(0,c.i18n)("TYPE:Bool")}},{key:"fieldNames",value:function(){return s(this._fields)}},{key:"_clone",value:function(){var t={};for(var r in this._fields)t[r]=this._fields[r];return new e(this._typeName,this._constructorName,t)}},{key:"updateFields",value:function(t){var e=this._clone();for(var r in t)e.fields[r]=t[r];return e}},{key:"equal",value:function(t){if(t.tag!==O)return!1;if(this.constructorName!==t.constructorName)return!1;var e=this.fieldNames(),r=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(!this.fields[s].equal(t.fields[s]))return!1}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return!0}},{key:"type",value:function(){var t={};for(var e in this._fields)t[e]=this._fields[e].type();var r={};return r[this._constructorName]=t,new P(this._typeName,r)}},{key:"typeName",get:function(){return this._typeName}},{key:"constructorName",get:function(){return this._constructorName}},{key:"fields",get:function(){return this._fields}}]),e}(A)},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=e.SourceReader=function(){function t(e,r){n(this,t),this._filename=e,this._string=r,this._index=0,this._line=1,this._column=1,this._regions=[]}return i(t,[{key:"_clone",value:function(){var e=new t(this._filename,this._string);return e._index=this._index,e._line=this._line,e._column=this._column,e._regions=this._regions,e}},{key:"consumeCharacter",value:function(){var t=this._clone();return"\n"===t.peek()?(t._line++,t._column=1):t._column++,t._index++,t}},{key:"consumeString",value:function(t){var e=this,r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value;e=e.consumeCharacter()}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e}},{key:"consumeInvisibleCharacter",value:function(){var t=this._clone();return t._index++,t}},{key:"consumeInvisibleString",value:function(t){var e=this,r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){o.value;e=e.consumeInvisibleCharacter()}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e}},{key:"startsWith",value:function(t){var e=this._index,r=this._index+t.length;return r<=this._string.length&&this._string.substring(e,r)===t}},{key:"eof",value:function(){return this._index>=this._string.length}},{key:"peek",value:function(){return this._string[this._index]}},{key:"beginRegion",value:function(t){var e=this._clone();return e._regions=[t].concat(e._regions),e}},{key:"endRegion",value:function(){var t=this._clone();return t._regions.length>0&&(t._regions=t._regions.slice(1)),t}},{key:"filename",get:function(){return this._filename}},{key:"line",get:function(){return this._line}},{key:"column",get:function(){return this._column}},{key:"region",get:function(){return this._regions.length>0?this._regions[0]:""}}]),t}();e.UnknownPosition=new o("(?)",""),e.MultifileReader=function(){function t(e){n(this,t),"string"==typeof e&&(e={"(?)":e}),this._filenames=Object.keys(e),this._filenames.sort(),this._input=e,this._index=0}return i(t,[{key:"moreFiles",value:function(){return this._index+1<this._filenames.length}},{key:"nextFile",value:function(){this._index++}},{key:"readCurrentFile",value:function(){if(this._index<this._filenames.length){var t=this._filenames[this._index];return new o(t,this._input[t])}return new o("(?)","")}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.T_EOF=Symbol.for("T_EOF"),e.T_NUM=Symbol.for("T_NUM"),e.T_STRING=Symbol.for("T_STRING"),e.T_UPPERID=Symbol.for("T_UPPERID"),e.T_LOWERID=Symbol.for("T_LOWERID"),e.T_PROGRAM=Symbol.for("T_PROGRAM"),e.T_INTERACTIVE=Symbol.for("T_INTERACTIVE"),e.T_PROCEDURE=Symbol.for("T_PROCEDURE"),e.T_FUNCTION=Symbol.for("T_FUNCTION"),e.T_RETURN=Symbol.for("T_RETURN"),e.T_IF=Symbol.for("T_IF"),e.T_THEN=Symbol.for("T_THEN"),e.T_ELSE=Symbol.for("T_ELSE"),e.T_REPEAT=Symbol.for("T_REPEAT"),e.T_FOREACH=Symbol.for("T_FOREACH"),e.T_IN=Symbol.for("T_IN"),e.T_WHILE=Symbol.for("T_WHILE"),e.T_SWITCH=Symbol.for("T_SWITCH"),e.T_TO=Symbol.for("T_TO"),e.T_LET=Symbol.for("T_LET"),e.T_NOT=Symbol.for("T_NOT"),e.T_DIV=Symbol.for("T_DIV"),e.T_MOD=Symbol.for("T_MOD"),e.T_TYPE=Symbol.for("T_TYPE"),e.T_IS=Symbol.for("T_IS"),e.T_RECORD=Symbol.for("T_RECORD"),e.T_VARIANT=Symbol.for("T_VARIANT"),e.T_CASE=Symbol.for("T_CASE"),e.T_FIELD=Symbol.for("T_FIELD"),e.T_UNDERSCORE=Symbol.for("T_UNDERSCORE"),e.T_TIMEOUT=Symbol.for("T_TIMEOUT"),e.T_LPAREN=Symbol.for("T_LPAREN"),e.T_RPAREN=Symbol.for("T_RPAREN"),e.T_LBRACE=Symbol.for("T_LBRACE"),e.T_RBRACE=Symbol.for("T_RBRACE"),e.T_LBRACK=Symbol.for("T_LBRACK"),e.T_RBRACK=Symbol.for("T_RBRACK"),e.T_COMMA=Symbol.for("T_COMMA"),e.T_SEMICOLON=Symbol.for("T_SEMICOLON"),e.T_RANGE=Symbol.for("T_RANGE"),e.T_GETS=Symbol.for("T_GETS"),e.T_PIPE=Symbol.for("T_PIPE"),e.T_ARROW=Symbol.for("T_ARROW"),e.T_ASSIGN=Symbol.for("T_ASSIGN"),e.T_EQ=Symbol.for("T_EQ"),e.T_NE=Symbol.for("T_NE"),e.T_LE=Symbol.for("T_LE"),e.T_GE=Symbol.for("T_GE"),e.T_LT=Symbol.for("T_LT"),e.T_GT=Symbol.for("T_GT"),e.T_AND=Symbol.for("T_AND"),e.T_OR=Symbol.for("T_OR"),e.T_CONCAT=Symbol.for("T_CONCAT"),e.T_PLUS=Symbol.for("T_PLUS"),e.T_MINUS=Symbol.for("T_MINUS"),e.T_TIMES=Symbol.for("T_TIMES"),e.T_POW=Symbol.for("T_POW"),e.Token=function(){function t(e,r,i,o){n(this,t),this._tag=e,this._value=r,this._startPos=i,this._endPos=o}return i(t,[{key:"toString",value:function(){var t=Symbol.keyFor(this._tag).substring(2);switch(t){case"NUM":case"STRING":case"UPPERID":case"LOWERID":return t+'("'+this._value+'")';default:return t}}},{key:"tag",get:function(){return this._tag}},{key:"value",get:function(){return this._value}},{key:"startPos",get:function(){return this._startPos}},{key:"endPos",get:function(){return this._endPos}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,r,n){throw new s.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.SymbolTable=e.LocalIndex=e.LocalParameter=e.LocalVariable=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(0),s=r(1),u=function(){function t(e,r,i){n(this,t),this._typeName=e,this._constructorName=r,this._index=i}return o(t,[{key:"typeName",get:function(){return this._typeName}},{key:"constructorName",get:function(){return this._constructorName}},{key:"index",get:function(){return this._index}}]),t}(),c=(e.LocalVariable=Symbol.for("LocalVariable"),e.LocalParameter=Symbol.for("LocalParameter"),e.LocalIndex=Symbol.for("LocalIndex"),function(){function t(e,r){n(this,t),this._category=e,this._position=r}return o(t,[{key:"category",get:function(){return this._category}},{key:"position",get:function(){return this._position}}]),t}());e.SymbolTable=function(){function t(){n(this,t),this._program=null,this._isInteractiveProgram=!1,this._procedures={},this._procedureParameters={},this._functions={},this._functionParameters={},this._types={},this._typeConstructors={},this._constructors={},this._constructorType={},this._constructorFields={},this._fields={},this._localNames={}}return o(t,[{key:"isInteractiveProgram",value:function(){return this._isInteractiveProgram}},{key:"isProcedure",value:function(t){return t in this._procedures}},{key:"allProcedureNames",value:function(){var t=[];for(var e in this._procedures)t.push(e);return t.sort()}},{key:"procedureDefinition",value:function(t){if(this.isProcedure(t))return this._procedures[t];throw Error("Undefined procedure.")}},{key:"procedureParameters",value:function(t){if(this.isProcedure(t))return this._procedureParameters[t];throw Error("Undefined procedure.")}},{key:"isFunction",value:function(t){return t in this._functions}},{key:"allFunctionNames",value:function(){var t=[];for(var e in this._functions)t.push(e);return t.sort()}},{key:"functionDefinition",value:function(t){if(this.isFunction(t))return this._functions[t];throw Error("Undefined function.")}},{key:"functionParameters",value:function(t){if(this.isFunction(t))return this._functionParameters[t];throw Error("Undefined function.")}},{key:"isType",value:function(t){return t in this._types}},{key:"typeDefinition",value:function(t){if(this.isType(t))return this._types[t];throw Error("Undefined type.")}},{key:"typeConstructors",value:function(t){if(this.isType(t))return this._typeConstructors[t];throw Error("Undefined type.")}},{key:"isConstructor",value:function(t){return t in this._constructors}},{key:"constructorDeclaration",value:function(t){if(this.isConstructor(t))return this._constructors[t];throw Error("Undefined constructor.")}},{key:"constructorType",value:function(t){if(this.isConstructor(t))return this._constructorType[t];throw Error("Undefined constructor.")}},{key:"constructorFields",value:function(t){if(this.isConstructor(t))return this._constructorFields[t];throw Error("Undefined constructor.")}},{key:"isField",value:function(t){return t in this._fields}},{key:"fieldDescriptor",value:function(t){if(this.isField(t))return this._fields[t];throw Error("Undefined field.")}},{key:"defProgram",value:function(t){null!==this._program&&i(t.startPos,t.endPos,"program-already-defined",[(0,a.i18nPosition)(this._program.startPos),(0,a.i18nPosition)(t.startPos)]),this._program=t}},{key:"defInteractiveProgram",value:function(t){this.defProgram(t),this._isInteractiveProgram=!0}},{key:"defProcedure",value:function(t){var e=t.name.value;e in this._procedures&&i(t.name.startPos,t.name.endPos,"procedure-already-defined",[e,(0,a.i18nPosition)(this._procedures[e].startPos),(0,a.i18nPosition)(t.startPos)]);var r=[],n=!0,o=!1,s=void 0;try{for(var u,c=t.parameters[Symbol.iterator]();!(n=(u=c.next()).done);n=!0){var l=u.value;r.push(l.value)}}catch(t){o=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(o)throw s}}this._procedures[e]=t,this._procedureParameters[e]=r}},{key:"defFunction",value:function(t){var e=t.name.value;if(e in this._functions)i(t.name.startPos,t.name.endPos,"function-already-defined",[e,(0,a.i18nPosition)(this._functions[e].startPos),(0,a.i18nPosition)(t.startPos)]);else if(e in this._fields){var r=this._constructors[this._fields[e][0].constructorName].startPos;i(t.name.startPos,t.name.endPos,"function-and-field-cannot-have-the-same-name",[e,(0,a.i18nPosition)(t.startPos),(0,a.i18nPosition)(r)])}var n=[],o=!0,s=!1,u=void 0;try{for(var c,l=t.parameters[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value;n.push(h.value)}}catch(t){s=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw u}}this._functions[e]=t,this._functionParameters[e]=n}},{key:"defType",value:function(t){var e=t.typeName.value;e in this._types&&i(t.typeName.startPos,t.typeName.endPos,"type-already-defined",[e,(0,a.i18nPosition)(this._types[e].startPos),(0,a.i18nPosition)(t.startPos)]),this._types[e]=t;var r=[],n=!0,o=!1,s=void 0;try{for(var u,c=t.constructorDeclarations[Symbol.iterator]();!(n=(u=c.next()).done);n=!0){var l=u.value;this._declareConstructor(e,l),r.push(l.constructorName.value)}}catch(t){o=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(o)throw s}}this._typeConstructors[e]=r}},{key:"_declareConstructor",value:function(t,e){var r=e.constructorName.value;r in this._constructors&&i(e.constructorName.startPos,e.constructorName.endPos,"constructor-already-defined",[r,(0,a.i18nPosition)(this._constructors[r].startPos),(0,a.i18nPosition)(e.startPos)]),this._constructors[r]=e,this._constructorType[r]=t;var n={},o=[],s=0,u=!0,c=!1,l=void 0;try{for(var h,f=e.fieldNames[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;p.value in n&&i(p.startPos,p.endPos,"repeated-field-name",[r,p.value]),n[p.value]=!0,o.push(p.value),this._declareField(p.startPos,p.endPos,t,r,p.value,s),s++}}catch(t){c=!0,l=t}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}this._constructorFields[r]=o}},{key:"_declareField",value:function(t,e,r,n,o,s){o in this._functions&&i(t,e,"function-and-field-cannot-have-the-same-name",[o,(0,a.i18nPosition)(this._functions[o].startPos),(0,a.i18nPosition)(t)]),o in this._fields||(this._fields[o]=[]),this._fields[o].push(new u(r,n,s))}},{key:"addNewLocalName",value:function(t,e){t.value in this._localNames&&i(t.startPos,t.endPos,"local-name-conflict",[t.value,(0,a.i18n)(Symbol.keyFor(this._localNames[t.value].category)),(0,a.i18nPosition)(this._localNames[t.value].position),(0,a.i18n)(Symbol.keyFor(e)),(0,a.i18nPosition)(t.startPos)]),this.setLocalName(t,e)}},{key:"setLocalName",value:function(t,e){t.value in this._localNames&&this._localNames[t.value].category!==e&&i(t.startPos,t.endPos,"local-name-conflict",[t.value,(0,a.i18n)(Symbol.keyFor(this._localNames[t.value].category)),(0,a.i18nPosition)(this._localNames[t.value].position),(0,a.i18n)(Symbol.keyFor(e)),(0,a.i18nPosition)(t.startPos)]),this._localNames[t.value]=new c(e,t.startPos)}},{key:"removeLocalName",value:function(t){delete this._localNames[t.value]}},{key:"exitScope",value:function(){this._localNames={}}},{key:"program",get:function(){return this._program}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){if(t instanceof Array){var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;e.push(a(u))}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return"["+e.join(", ")+"]"}return t.toString()}Object.defineProperty(e,"__esModule",{value:!0}),e.ITypeCheck=e.IRestoreState=e.ISaveState=e.IPrimitiveCall=e.IPop=e.IDup=e.IAdd=e.IReadStructureFieldPop=e.IReadStructureField=e.IReadTupleComponent=e.IUpdateStructure=e.IMakeStructure=e.IMakeList=e.IMakeTuple=e.IReturn=e.ICall=e.IJumpIfTuple=e.IJumpIfStructure=e.IJumpIfFalse=e.IJump=e.ILabel=e.IUnsetVariable=e.ISetVariable=e.IPushVariable=e.IPushString=e.IPushInteger=e.Instruction=e.Code=e.I_TypeCheck=e.I_RestoreState=e.I_SaveState=e.I_PrimitiveCall=e.I_Pop=e.I_Dup=e.I_Add=e.I_ReadStructureFieldPop=e.I_ReadStructureField=e.I_ReadTupleComponent=e.I_UpdateStructure=e.I_MakeStructure=e.I_MakeList=e.I_MakeTuple=e.I_Return=e.I_Call=e.I_JumpIfTuple=e.I_JumpIfStructure=e.I_JumpIfFalse=e.I_Jump=e.I_Label=e.I_UnsetVariable=e.I_SetVariable=e.I_PushVariable=e.I_PushString=e.I_PushInteger=void 0;var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(5),c=e.I_PushInteger=Symbol.for("I_PushInteger"),l=e.I_PushString=Symbol.for("I_PushString"),h=e.I_PushVariable=Symbol.for("I_PushVariable"),f=e.I_SetVariable=Symbol.for("I_SetVariable"),p=e.I_UnsetVariable=Symbol.for("I_UnsetVariable"),_=e.I_Label=Symbol.for("I_Label"),m=e.I_Jump=Symbol.for("I_Jump"),d=e.I_JumpIfFalse=Symbol.for("I_JumpIfFalse"),y=e.I_JumpIfStructure=Symbol.for("I_JumpIfStructure"),v=e.I_JumpIfTuple=Symbol.for("I_JumpIfTuple"),g=e.I_Call=Symbol.for("I_Call"),b=e.I_Return=Symbol.for("I_Return"),T=e.I_MakeTuple=Symbol.for("I_MakeTuple"),S=e.I_MakeList=Symbol.for("I_MakeList"),P=e.I_MakeStructure=Symbol.for("I_MakeStructure"),k=e.I_UpdateStructure=Symbol.for("I_UpdateStructure"),w=e.I_ReadTupleComponent=Symbol.for("I_ReadTupleComponent"),E=e.I_ReadStructureField=Symbol.for("I_ReadStructureField"),I=e.I_ReadStructureFieldPop=Symbol.for("I_ReadStructureFieldPop"),N=e.I_Add=Symbol.for("I_Add"),R=e.I_Dup=Symbol.for("I_Dup"),x=e.I_Pop=Symbol.for("I_Pop"),C=e.I_PrimitiveCall=Symbol.for("I_PrimitiveCall"),O=e.I_SaveState=Symbol.for("I_SaveState"),A=e.I_RestoreState=Symbol.for("I_RestoreState"),L=e.I_TypeCheck=Symbol.for("I_TypeCheck"),F=(e.Code=function(){function t(e){o(this,t),this._instructions=e}return s(t,[{key:"toString",value:function(){var t=[],e=!0,r=!1,n=void 0;try{for(var i,o=this._instructions[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.push(a.toString())}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return t.join("\n")}},{key:"produce",value:function(t){this._instructions.push(t)}},{key:"at",value:function(t){if(0<=t&&t<this._instructions.length)return this._instructions[t];throw Error("Code: instruction pointer out of range.")}},{key:"labelTargets",value:function(){for(var t={},e=0;e<this._instructions.length;e++)if(this._instructions[e].opcode===_){var r=this._instructions[e].label;if(r in t)throw Error('Code: label "'+r+'" is repeated.');t[r]=e}return t}}]),t}(),e.Instruction=function(){function t(e,r){o(this,t),this._opcode=e,this._args=r,this._startPos=u.UnknownPosition,this._endPos=u.UnknownPosition}return s(t,[{key:"toString",value:function(){var t=Symbol.keyFor(this._opcode).substring(2),e=[],r=!0,n=!1,i=void 0;try{for(var o,s=this._args[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;e.push(a(u))}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return"  "+t+" "+e.join(", ")}},{key:"opcode",get:function(){return this._opcode}},{key:"args",get:function(){return this._args}},{key:"startPos",set:function(t){this._startPos=t},get:function(){return this._startPos}},{key:"endPos",set:function(t){this._endPos=t},get:function(){return this._endPos}}]),t}());e.IPushInteger=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,[t]))}return i(e,t),s(e,[{key:"number",get:function(){return this._args[0]}}]),e}(F),e.IPushString=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l,[t]))}return i(e,t),s(e,[{key:"string",get:function(){return this._args[0]}}]),e}(F),e.IPushVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,h,[t]))}return i(e,t),s(e,[{key:"variableName",get:function(){return this._args[0]}}]),e}(F),e.ISetVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,f,[t]))}return i(e,t),s(e,[{key:"variableName",get:function(){return this._args[0]}}]),e}(F),e.IUnsetVariable=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p,[t]))}return i(e,t),s(e,[{key:"variableName",get:function(){return this._args[0]}}]),e}(F),e.ILabel=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,_,[t]))}return i(e,t),s(e,[{key:"toString",value:function(){return this.label+":"}},{key:"label",get:function(){return this._args[0]}}]),e}(F),e.IJump=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,m,[t]))}return i(e,t),s(e,[{key:"targetLabel",get:function(){return this._args[0]}}]),e}(F),e.IJumpIfFalse=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,d,[t]))}return i(e,t),s(e,[{key:"targetLabel",get:function(){return this._args[0]}}]),e}(F),e.IJumpIfStructure=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,y,[t,r]))}return i(e,t),s(e,[{key:"constructorName",get:function(){return this._args[0]}},{key:"targetLabel",get:function(){return this._args[1]}}]),e}(F),e.IJumpIfTuple=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,v,[t,r]))}return i(e,t),s(e,[{key:"size",get:function(){return this._args[0]}},{key:"targetLabel",get:function(){return this._args[1]}}]),e}(F),e.ICall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,g,[t,r]))}return i(e,t),s(e,[{key:"targetLabel",get:function(){return this._args[0]}},{key:"nargs",get:function(){return this._args[1]}}]),e}(F),e.IReturn=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b,[]))}return i(e,t),e}(F),e.IMakeTuple=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,T,[t]))}return i(e,t),s(e,[{key:"size",get:function(){return this._args[0]}}]),e}(F),e.IMakeList=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,S,[t]))}return i(e,t),s(e,[{key:"size",get:function(){return this._args[0]}}]),e}(F),e.IMakeStructure=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,P,[t,r,i]))}return i(e,t),s(e,[{key:"typeName",get:function(){return this._args[0]}},{key:"constructorName",get:function(){return this._args[1]}},{key:"fieldNames",get:function(){return this._args[2]}}]),e}(F),e.IUpdateStructure=function(t){function e(t,r,i){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,k,[t,r,i]))}return i(e,t),s(e,[{key:"typeName",get:function(){return this._args[0]}},{key:"constructorName",get:function(){return this._args[1]}},{key:"fieldNames",get:function(){return this._args[2]}}]),e}(F),e.IReadTupleComponent=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,w,[t]))}return i(e,t),s(e,[{key:"index",get:function(){return this._args[0]}}]),e}(F),e.IReadStructureField=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,E,[t]))}return i(e,t),s(e,[{key:"fieldName",get:function(){return this._args[0]}}]),e}(F),e.IReadStructureFieldPop=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,I,[t]))}return i(e,t),s(e,[{key:"fieldName",get:function(){return this._args[0]}}]),e}(F),e.IAdd=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,N,[]))}return i(e,t),e}(F),e.IDup=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,R,[]))}return i(e,t),e}(F),e.IPop=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,x,[]))}return i(e,t),e}(F),e.IPrimitiveCall=function(t){function e(t,r){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,C,[t,r]))}return i(e,t),s(e,[{key:"primitiveName",get:function(){return this._args[0]}},{key:"nargs",get:function(){return this._args[1]}}]),e}(F),e.ISaveState=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,O,[]))}return i(e,t),e}(F),e.IRestoreState=function(t){function e(){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,A,[]))}return i(e,t),e}(F),e.ITypeCheck=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,L,[t]))}return i(e,t),s(e,[{key:"type",get:function(){return this._args[0]}}]),e}(F)},function(t,e,r){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){var e=new l.RuntimeState;return e.load((0,p.apiboardToJboard)(t)),e}function s(t){return(0,p.apiboardFromJboard)(t.dump())}function u(t){return null===t?null:t.isInteger()?{type:(0,f.i18n)("TYPE:Integer"),value:t.asNumber()}:t.isBoolean()?{type:(0,f.i18n)("TYPE:Bool"),value:(0,l.boolFromValue)(t)}:t.isString()?{type:(0,f.i18n)("TYPE:String"),value:t.string}:t.isStructure()?{type:t.typeName,value:t.toString()}:{type:t.type().toString(),value:t.toString()}}Object.defineProperty(e,"__esModule",{value:!0}),e.GobstonesInterpreterAPI=void 0;var c=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),l=r(3),h=r(11),f=r(0),p=r(17),_=r(4),m=r(2),d=function t(e){o(this,t),this.message=e.message,this.reason={code:e.reason,detail:e.args},this.on={range:{start:{row:e.startPos.line,column:e.startPos.column},end:{row:e.endPos.line,column:e.endPos.column}},region:e.startPos.region}},y=function(t){function e(t){return o(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return i(e,t),e}(d),v=function(t){function e(t,r){o(this,e);var i=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.snapshots=r,i}return i(e,t),e}(d),g=function t(e,r,n){o(this,t),this.finalBoard=e,this.snapshots=r,this.returnValue=u(n),this.actualReturnValue=n},b=function(){function t(e){o(this,t),this.keys=this._collectKeyNames(e),this.timeout=this._timeoutValue(e),this.onInit=this._onInitFunction(e),this.onKey=this._onKeyFunction(e),this.onTimeout=this._onTimeoutFunction(e)}return c(t,[{key:"_hasInit",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.runner.symbolTable.program.branches[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=a.pattern;if(s.tag===m.N_PatternStructure&&s.constructorName.value===(0,f.i18n)("CONS:INIT"))return!0}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return!1}},{key:"_hasTimeout",value:function(t){return null!==this.timeout}},{key:"_collectKeyNames",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t.runner.symbolTable.program.branches[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=s.pattern;u.tag===m.N_PatternStructure&&u.constructorName.value!==(0,f.i18n)("CONS:INIT")&&e.push(u.constructorName.value)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return e}},{key:"_timeoutValue",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.runner.symbolTable.program.branches[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(a.pattern.tag===m.N_PatternTimeout)return a.pattern.timeout}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return null}},{key:"_onInitFunction",value:function(t){if(this._hasInit(t)){var e=this;return function(){return(0,f.i18nWithLanguage)(t.language,function(){return e._onEvent(t,new _.ValueStructure((0,f.i18n)("TYPE:Event"),(0,f.i18n)("CONS:INIT")))})}}return function(){return(0,f.i18nWithLanguage)(t.language,function(){return s(t.runner.globalState)})}}},{key:"_onTimeoutFunction",value:function(t){if(this._hasTimeout(t)){var e=this;return function(){return(0,f.i18nWithLanguage)(t.language,function(){return e._onEvent(t,new _.ValueStructure((0,f.i18n)("TYPE:Event"),(0,f.i18n)("CONS:TIMEOUT")))})}}return function(){return(0,f.i18nWithLanguage)(t.language,function(){return s(t.runner.globalState)})}}},{key:"_onKeyFunction",value:function(t){var e=this;return function(r){return(0,f.i18nWithLanguage)(t.language,function(){return e._onEvent(t,new _.ValueStructure((0,f.i18n)("TYPE:Event"),r))})}}},{key:"_onEvent",value:function(t,e){return(0,f.i18nWithLanguage)(t.language,function(){try{return t.runner.executeEventWithTimeout(e,t.infiniteLoopTimeout),s(t.runner.globalState)}catch(t){if(void 0===t.isGobstonesException)throw t;return new v(t)}})}}]),t}(),T=function(){function t(e){o(this,t),this._runner=e,this._snapshots=[],this._index=0}return c(t,[{key:"takeSnapshot",value:function(t,e,r,n){this._shouldTakeSnapshot(t,r)&&this._snapshots.push(this._snapshot(t,e,r,n))}},{key:"snapshots",value:function(){return this._snapshots}},{key:"_snapshot",value:function(t,e,r,n){var i={};i.contextNames=[];var o=!0,a=!1,u=void 0;try{for(var c,l=r[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var h=c.value,f=h.routineName;"program"!==f&&(this._index+=1,f=f+"-"+this._index.toString()),i.contextNames.push(f)}}catch(t){a=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw u}}return i.board=s(n),i.region=e.region,i}},{key:"_shouldTakeSnapshot",value:function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;r.push(u.routineName)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return this._runner.primitives.isProcedure(t)?this._noAtomicRoutines(r):(r.pop(),this._isRecorded(t)&&this._noAtomicRoutines(r))}},{key:"_noAtomicRoutines",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;if(this._isAtomic(a))return!1}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}return!0}},{key:"_isAtomic",value:function(t){return"program"!==t&&(!this._runner.primitives.isProcedure(t)&&!this._runner.symbolTable.isProcedure(t))}},{key:"_isRecorded",value:function(t){return"program"===t||(!!this._runner.primitives.isProcedure(t)||(this._runner.symbolTable.isProcedure(t),!1))}}]),t}(),S=function(){function t(e){o(this,t),null===e.runner.symbolTable.program?this.program=null:e.runner.symbolTable.isInteractiveProgram()?this.program=this._resultForInteractiveProgram(e):this.program=this._resultForProgram(e),this.declarations=this._collectDeclarations(e.runner)}return c(t,[{key:"_resultForProgram",value:function(t){var e={};return e.alias="program",e.interpret=function(e){var r=new T(t.runner);return(0,f.i18nWithLanguage)(t.language,function(){try{t.runner.compile(),t.runner.executeWithTimeoutTakingSnapshots(a(e),t.infiniteLoopTimeout,r.takeSnapshot.bind(r));var n=s(t.runner.globalState),i=t.runner.result;return new g(n,r.snapshots(),i)}catch(t){if(void 0===t.isGobstonesException)throw t;return new v(t,r.snapshots())}})},e}},{key:"_resultForInteractiveProgram",value:function(t){var e={};return e.alias="interactiveProgram",e.interpret=function(e){return(0,f.i18nWithLanguage)(t.language,function(){try{return t.runner.compile(),t.runner.initializeVirtualMachine(a(e)),new b(t)}catch(t){if(void 0===t.isGobstonesException)throw t;return new v(t)}})},e}},{key:"_collectDeclarations",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,a=t.symbolTable.allProcedureNames()[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;t.primitives.isProcedure(s)||e.push({alias:"procedureDeclaration",name:s})}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}var u=!0,c=!1,l=void 0;try{for(var h,f=t.symbolTable.allFunctionNames()[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;t.primitives.isFunction(p)||e.push({alias:"functionDeclaration",name:p})}}catch(t){c=!0,l=t}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}return e}}]),t}();e.GobstonesInterpreterAPI=function t(){o(this,t);var e={infiniteLoopTimeout:3e3,language:"es",runner:new h.Runner};this.config={setLanguage:function(t){e.language=t},setInfiniteLoopTimeout:function(t){e.infiniteLoopTimeout=t},setXGobstonesEnabled:function(t){}},this.gbb={read:function(t){return(0,p.apiboardFromJboard)((0,p.gbbToJboard)(t))},write:function(t){return(0,p.gbbFromJboard)((0,p.apiboardToJboard)(t))}},this.parse=function(t){return(0,f.i18nWithLanguage)(e.language,function(){try{return e.runner.initialize(),e.runner.parse(t),e.runner.enableLintCheck("source-should-have-a-program-definition",!1),e.runner.lint(),new S(e)}catch(t){if(void 0===t.isGobstonesException)throw t;return new y(t)}})}}},function(t,e,r){"use strict";function n(t,e){return void 0===t?n[0]:void 0!==e?10==+e?q(t):et(t,e):q(t)}function i(t,e){this.value=t,this.sign=e,this.isSmall=!1}function o(t){this.value=t,this.sign=t<0,this.isSmall=!0}function a(t){return-z<t&&t<z}function s(t){return t<1e7?[t]:t<1e14?[t%1e7,Math.floor(t/1e7)]:[t%1e7,Math.floor(t/1e7)%1e7,Math.floor(t/1e14)]}function u(t){c(t);var e=t.length;if(e<4&&R(t,H)<0)switch(e){case 0:return 0;case 1:return t[0];case 2:return t[0]+t[1]*J;default:return t[0]+(t[1]+t[2]*J)*J}return t}function c(t){for(var e=t.length;0===t[--e];);t.length=e+1}function l(t){for(var e=new Array(t),r=-1;++r<t;)e[r]=0;return e}function h(t){return t>0?Math.floor(t):Math.ceil(t)}function f(t,e){var r,n,i=t.length,o=e.length,a=new Array(i),s=0,u=J;for(n=0;n<o;n++)r=t[n]+e[n]+s,s=r>=u?1:0,a[n]=r-s*u;for(;n<i;)r=t[n]+s,s=r===u?1:0,a[n++]=r-s*u;return s>0&&a.push(s),a}function p(t,e){return t.length>=e.length?f(t,e):f(e,t)}function _(t,e){var r,n,i=t.length,o=new Array(i),a=J;for(n=0;n<i;n++)r=t[n]-a+e,e=Math.floor(r/a),o[n]=r-e*a,e+=1;for(;e>0;)o[n++]=e%a,e=Math.floor(e/a);return o}function m(t,e){var r,n,i=t.length,o=e.length,a=new Array(i),s=0,u=J;for(r=0;r<o;r++)n=t[r]-s-e[r],n<0?(n+=u,s=1):s=0,a[r]=n;for(r=o;r<i;r++){if(!((n=t[r]-s)<0)){a[r++]=n;break}n+=u,a[r]=n}for(;r<i;r++)a[r]=t[r];return c(a),a}function d(t,e,r){var n;return R(t,e)>=0?n=m(t,e):(n=m(e,t),r=!r),n=u(n),"number"==typeof n?(r&&(n=-n),new o(n)):new i(n,r)}function y(t,e,r){var n,a,s=t.length,c=new Array(s),l=-e,h=J;for(n=0;n<s;n++)a=t[n]+l,l=Math.floor(a/h),a%=h,c[n]=a<0?a+h:a;return c=u(c),"number"==typeof c?(r&&(c=-c),new o(c)):new i(c,r)}function v(t,e){var r,n,i,o,a,s=t.length,u=e.length,h=s+u,f=l(h),p=J;for(i=0;i<s;++i){o=t[i];for(var _=0;_<u;++_)a=e[_],r=o*a+f[i+_],n=Math.floor(r/p),f[i+_]=r-n*p,f[i+_+1]+=n}return c(f),f}function g(t,e){var r,n,i=t.length,o=new Array(i),a=J,s=0;for(n=0;n<i;n++)r=t[n]*e+s,s=Math.floor(r/a),o[n]=r-s*a;for(;s>0;)o[n++]=s%a,s=Math.floor(s/a);return o}function b(t,e){for(var r=[];e-- >0;)r.push(0);return r.concat(t)}function T(t,e){var r=Math.max(t.length,e.length);if(r<=30)return v(t,e);r=Math.ceil(r/2);var n=t.slice(r),i=t.slice(0,r),o=e.slice(r),a=e.slice(0,r),s=T(i,a),u=T(n,o),l=T(p(i,n),p(a,o)),h=p(p(s,b(m(m(l,s),u),r)),b(u,2*r));return c(h),h}function S(t,e){return-.012*t-.012*e+15e-6*t*e>0}function P(t,e,r){return t<J?new i(g(e,t),r):new i(v(e,s(t)),r)}function k(t){var e,r,n,i,o,a=t.length,s=l(a+a),u=J;for(n=0;n<a;n++){i=t[n];for(var h=0;h<a;h++)o=t[h],e=i*o+s[n+h],r=Math.floor(e/u),s[n+h]=e-r*u,s[n+h+1]+=r}return c(s),s}function w(t,e){var r,n,i,o,a,s,c,h=t.length,f=e.length,p=J,_=l(e.length),m=e[f-1],d=Math.ceil(p/(2*m)),y=g(t,d),v=g(e,d);for(y.length<=h&&y.push(0),v.push(0),m=v[f-1],n=h-f;n>=0;n--){for(r=p-1,y[n+f]!==m&&(r=Math.floor((y[n+f]*p+y[n+f-1])/m)),i=0,o=0,s=v.length,a=0;a<s;a++)i+=r*v[a],c=Math.floor(i/p),o+=y[n+a]-(i-c*p),i=c,o<0?(y[n+a]=o+p,o=-1):(y[n+a]=o,o=0);for(;0!==o;){for(r-=1,i=0,a=0;a<s;a++)i+=y[n+a]-p+v[a],i<0?(y[n+a]=i+p,i=0):(y[n+a]=i,i=1);o+=i}_[n]=r}return y=I(y,d)[0],[u(_),u(y)]}function E(t,e){for(var r,n,i,o,a,s=t.length,l=e.length,h=[],f=[],p=J;s;)if(f.unshift(t[--s]),c(f),R(f,e)<0)h.push(0);else{n=f.length,i=f[n-1]*p+f[n-2],o=e[l-1]*p+e[l-2],n>l&&(i=(i+1)*p),r=Math.ceil(i/o);do{if(a=g(e,r),R(a,f)<=0)break;r--}while(r);h.push(r),f=m(f,a)}return h.reverse(),[u(h),u(f)]}function I(t,e){var r,n,i,o,a=t.length,s=l(a),u=J;for(i=0,r=a-1;r>=0;--r)o=i*u+t[r],n=h(o/e),i=o-n*e,s[r]=0|n;return[s,0|i]}function N(t,e){var r,a,c=q(e),l=t.value,f=c.value;if(0===f)throw new Error("Cannot divide by zero");if(t.isSmall)return c.isSmall?[new o(h(l/f)),new o(l%f)]:[n[0],t];if(c.isSmall){if(1===f)return[t,n[0]];if(-1==f)return[t.negate(),n[0]];var p=Math.abs(f);if(p<J){r=I(l,p),a=u(r[0]);var _=r[1];return t.sign&&(_=-_),"number"==typeof a?(t.sign!==c.sign&&(a=-a),[new o(a),new o(_)]):[new i(a,t.sign!==c.sign),new o(_)]}f=s(p)}var m=R(l,f);if(-1===m)return[n[0],t];if(0===m)return[n[t.sign===c.sign?1:-1],n[0]];r=l.length+f.length<=200?w(l,f):E(l,f),a=r[0];var d=t.sign!==c.sign,y=r[1],v=t.sign;return"number"==typeof a?(d&&(a=-a),a=new o(a)):a=new i(a,d),"number"==typeof y?(v&&(y=-y),y=new o(y)):y=new i(y,v),[a,y]}function R(t,e){if(t.length!==e.length)return t.length>e.length?1:-1;for(var r=t.length-1;r>=0;r--)if(t[r]!==e[r])return t[r]>e[r]?1:-1;return 0}function x(t){var e=t.abs();return!e.isUnit()&&(!!(e.equals(2)||e.equals(3)||e.equals(5))||!(e.isEven()||e.isDivisibleBy(3)||e.isDivisibleBy(5))&&(!!e.lesser(25)||void 0))}function C(t){return("number"==typeof t||"string"==typeof t)&&+Math.abs(t)<=J||t instanceof i&&t.value.length<=1}function O(t,e,r){e=q(e);for(var n=t.isNegative(),i=e.isNegative(),o=n?t.not():t,a=i?e.not():e,s=[],u=[],c=!1,l=!1;!c||!l;)o.isZero()?(c=!0,s.push(n?1:0)):n?s.push(o.isEven()?1:0):s.push(o.isEven()?0:1),a.isZero()?(l=!0,u.push(i?1:0)):i?u.push(a.isEven()?1:0):u.push(a.isEven()?0:1),o=o.over(2),a=a.over(2);for(var h=[],f=0;f<s.length;f++)h.push(r(s[f],u[f]));for(var p=bigInt(h.pop()).negate().times(bigInt(2).pow(h.length));h.length;)p=p.add(bigInt(h.pop()).times(bigInt(2).pow(h.length)));return p}function A(t){var e=t.value,r="number"==typeof e?e|$:e[0]+e[1]*J|tt;return r&-r}function L(t,e){return t=q(t),e=q(e),t.greater(e)?t:e}function F(t,e){return t=q(t),e=q(e),t.lesser(e)?t:e}function D(t,e){if(t=q(t).abs(),e=q(e).abs(),t.equals(e))return t;if(t.isZero())return e;if(e.isZero())return t;for(var r,i,o=n[1];t.isEven()&&e.isEven();)r=Math.min(A(t),A(e)),t=t.divide(r),e=e.divide(r),o=o.multiply(r);for(;t.isEven();)t=t.divide(A(t));do{for(;e.isEven();)e=e.divide(A(e));t.greater(e)&&(i=e,e=t,t=i),e=e.subtract(t)}while(!e.isZero());return o.isUnit()?t:t.multiply(o)}function M(t,e){return t=q(t).abs(),e=q(e).abs(),t.divide(D(t,e)).multiply(e)}function V(t,e){t=q(t),e=q(e);var r=F(t,e),n=L(t,e),a=n.subtract(r);if(a.isSmall)return r.add(Math.round(Math.random()*a));for(var s=a.value.length-1,c=[],l=!0,f=s;f>=0;f--){var p=l?a.value[f]:J,_=h(Math.random()*p);c.unshift(_),_<p&&(l=!1)}return c=u(c),r.add("number"==typeof c?new o(c):new i(c,!1))}function B(t,e,r){var i,o=n[0],a=n[1];for(i=t.length-1;i>=0;i--)o=o.add(t[i].times(a)),a=a.times(e);return r?o.negate():o}function j(t){var e=t.value;return"number"==typeof e&&(e=[e]),1===e.length&&e[0]<=35?"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e[0]):"<"+e+">"}function U(t,e){if(e=bigInt(e),e.isZero()){if(t.isZero())return"0";throw new Error("Cannot convert nonzero numbers to base 0.")}if(e.equals(-1))return t.isZero()?"0":t.isNegative()?new Array(1-t).join("10"):"1"+new Array(+t).join("01");var r="";if(t.isNegative()&&e.isPositive()&&(r="-",t=t.abs()),e.equals(1))return t.isZero()?"0":r+new Array(+t+1).join(1);for(var n,i=[],o=t;o.isNegative()||o.compareAbs(e)>=0;){n=o.divmod(e),o=n.quotient;var a=n.remainder;a.isNegative()&&(a=e.minus(a).abs(),o=o.next()),i.push(j(a))}return i.push(j(o)),r+i.reverse().join("")}function W(t){if(a(+t)){var e=+t;if(e===h(e))return new o(e);throw"Invalid integer: "+t}var r="-"===t[0];r&&(t=t.slice(1));var n=t.split(/e/i);if(n.length>2)throw new Error("Invalid integer: "+n.join("e"));if(2===n.length){var s=n[1];if("+"===s[0]&&(s=s.slice(1)),(s=+s)!==h(s)||!a(s))throw new Error("Invalid integer: "+s+" is not a valid exponent.");var u=n[0],l=u.indexOf(".");if(l>=0&&(s-=u.length-l-1,u=u.slice(0,l)+u.slice(l+1)),s<0)throw new Error("Cannot include negative exponent part for integers");u+=new Array(s+1).join("0"),t=u}if(!/^([0-9][0-9]*)$/.test(t))throw new Error("Invalid integer: "+t);for(var f=[],p=t.length,_=Y,m=p-_;p>0;)f.push(+t.slice(m,p)),m-=_,m<0&&(m=0),p-=_;return c(f),new i(f,r)}function G(t){if(a(t)){if(t!==h(t))throw new Error(t+" is not an integer.");return new o(t)}return W(t.toString())}function q(t){return"number"==typeof t?G(t):"string"==typeof t?W(t):t}Object.defineProperty(e,"__esModule",{value:!0}),e.Integer=n;var J=1e7,Y=7,z=9007199254740992,H=s(z),K=Math.log(z);i.prototype=Object.create(n.prototype),o.prototype=Object.create(n.prototype),i.prototype.add=function(t){var e=q(t);if(this.sign!==e.sign)return this.subtract(e.negate());var r=this.value,n=e.value;return e.isSmall?new i(_(r,Math.abs(n)),this.sign):new i(p(r,n),this.sign)},i.prototype.plus=i.prototype.add,o.prototype.add=function(t){var e=q(t),r=this.value;if(r<0!==e.sign)return this.subtract(e.negate());var n=e.value;if(e.isSmall){if(a(r+n))return new o(r+n);n=s(Math.abs(n))}return new i(_(n,Math.abs(r)),r<0)},o.prototype.plus=o.prototype.add,i.prototype.subtract=function(t){var e=q(t);if(this.sign!==e.sign)return this.add(e.negate());var r=this.value,n=e.value;return e.isSmall?y(r,Math.abs(n),this.sign):d(r,n,this.sign)},i.prototype.minus=i.prototype.subtract,o.prototype.subtract=function(t){var e=q(t),r=this.value;if(r<0!==e.sign)return this.add(e.negate());var n=e.value;return e.isSmall?new o(r-n):y(n,Math.abs(r),r>=0)},o.prototype.minus=o.prototype.subtract,i.prototype.negate=function(){return new i(this.value,!this.sign)},o.prototype.negate=function(){var t=this.sign,e=new o(-this.value);return e.sign=!t,e},i.prototype.abs=function(){return new i(this.value,!1)},o.prototype.abs=function(){return new o(Math.abs(this.value))},i.prototype.multiply=function(t){var e,r=q(t),o=this.value,a=r.value,u=this.sign!==r.sign;if(r.isSmall){if(0===a)return n[0];if(1===a)return this;if(-1===a)return this.negate();if((e=Math.abs(a))<J)return new i(g(o,e),u);a=s(e)}return S(o.length,a.length)?new i(T(o,a),u):new i(v(o,a),u)},i.prototype.times=i.prototype.multiply,o.prototype._multiplyBySmall=function(t){return a(t.value*this.value)?new o(t.value*this.value):P(Math.abs(t.value),s(Math.abs(this.value)),this.sign!==t.sign)},i.prototype._multiplyBySmall=function(t){return 0===t.value?n[0]:1===t.value?this:-1===t.value?this.negate():P(Math.abs(t.value),this.value,this.sign!==t.sign)},o.prototype.multiply=function(t){return q(t)._multiplyBySmall(this)},o.prototype.times=o.prototype.multiply,i.prototype.square=function(){return new i(k(this.value),!1)},o.prototype.square=function(){var t=this.value*this.value;return a(t)?new o(t):new i(k(s(Math.abs(this.value))),!1)},i.prototype.divmod=function(t){var e=N(this,t);return{quotient:e[0],remainder:e[1]}},o.prototype.divmod=i.prototype.divmod,i.prototype.divide=function(t){return N(this,t)[0]},o.prototype.over=o.prototype.divide=i.prototype.over=i.prototype.divide,i.prototype.mod=function(t){return N(this,t)[1]},o.prototype.remainder=o.prototype.mod=i.prototype.remainder=i.prototype.mod,i.prototype.pow=function(t){var e,r,i,s=q(t),u=this.value,c=s.value;if(0===c)return n[1];if(0===u)return n[0];if(1===u)return n[1];if(-1===u)return s.isEven()?n[1]:n[-1];if(s.sign)return n[0];if(!s.isSmall)throw new Error("The exponent "+s.toString()+" is too large.");if(this.isSmall&&a(e=Math.pow(u,c)))return new o(h(e));for(r=this,i=n[1];;){if(!0&c&&(i=i.times(r),--c),0===c)break;c/=2,r=r.square()}return i},o.prototype.pow=i.prototype.pow,i.prototype.modPow=function(t,e){if(t=q(t),e=q(e),e.isZero())throw new Error("Cannot take modPow with modulus 0");for(var r=n[1],i=this.mod(e);t.isPositive();){if(i.isZero())return n[0];t.isOdd()&&(r=r.multiply(i).mod(e)),t=t.divide(2),i=i.square().mod(e)}return r},o.prototype.modPow=i.prototype.modPow,i.prototype.compareAbs=function(t){var e=q(t),r=this.value,n=e.value;return e.isSmall?1:R(r,n)},o.prototype.compareAbs=function(t){var e=q(t),r=Math.abs(this.value),n=e.value;return e.isSmall?(n=Math.abs(n),r===n?0:r>n?1:-1):-1},i.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=q(t),r=this.value,n=e.value;return this.sign!==e.sign?e.sign?1:-1:e.isSmall?this.sign?-1:1:R(r,n)*(this.sign?-1:1)},i.prototype.compareTo=i.prototype.compare,o.prototype.compare=function(t){if(t===1/0)return-1;if(t===-1/0)return 1;var e=q(t),r=this.value,n=e.value;return e.isSmall?r==n?0:r>n?1:-1:r<0!==e.sign?r<0?-1:1:r<0?1:-1},o.prototype.compareTo=o.prototype.compare,i.prototype.equals=function(t){return 0===this.compare(t)},o.prototype.eq=o.prototype.equals=i.prototype.eq=i.prototype.equals,i.prototype.notEquals=function(t){return 0!==this.compare(t)},o.prototype.neq=o.prototype.notEquals=i.prototype.neq=i.prototype.notEquals,i.prototype.greater=function(t){return this.compare(t)>0},o.prototype.gt=o.prototype.greater=i.prototype.gt=i.prototype.greater,i.prototype.lesser=function(t){return this.compare(t)<0},o.prototype.lt=o.prototype.lesser=i.prototype.lt=i.prototype.lesser,i.prototype.greaterOrEquals=function(t){return this.compare(t)>=0},o.prototype.geq=o.prototype.greaterOrEquals=i.prototype.geq=i.prototype.greaterOrEquals,i.prototype.lesserOrEquals=function(t){return this.compare(t)<=0},o.prototype.leq=o.prototype.lesserOrEquals=i.prototype.leq=i.prototype.lesserOrEquals,i.prototype.isEven=function(){return 0==(1&this.value[0])},o.prototype.isEven=function(){return 0==(1&this.value)},i.prototype.isOdd=function(){return 1==(1&this.value[0])},o.prototype.isOdd=function(){return 1==(1&this.value)},i.prototype.isPositive=function(){return!this.sign},o.prototype.isPositive=function(){return this.value>0},i.prototype.isNegative=function(){return this.sign},o.prototype.isNegative=function(){return this.value<0},i.prototype.isUnit=function(){return!1},o.prototype.isUnit=function(){return 1===Math.abs(this.value)},i.prototype.isZero=function(){return!1},o.prototype.isZero=function(){return 0===this.value},i.prototype.isDivisibleBy=function(t){var e=q(t),r=e.value;return 0!==r&&(1===r||(2===r?this.isEven():this.mod(e).equals(n[0])))},o.prototype.isDivisibleBy=i.prototype.isDivisibleBy,i.prototype.isPrime=function(){var t=x(this);if(void 0!==t)return t;for(var e,r,i,o,a=this.abs(),s=a.prev(),u=[2,3,5,7,11,13,17,19],c=s;c.isEven();)c=c.divide(2);for(i=0;i<u.length;i++)if(o=bigInt(u[i]).modPow(c,a),!o.equals(n[1])&&!o.equals(s)){for(r=!0,e=c;r&&e.lesser(s);e=e.multiply(2))o=o.square().mod(a),o.equals(s)&&(r=!1);if(r)return!1}return!0},o.prototype.isPrime=i.prototype.isPrime,i.prototype.isProbablePrime=function(t){var e=x(this);if(void 0!==e)return e;for(var r=this.abs(),n=void 0===t?5:t,i=0;i<n;i++){if(!bigInt.randBetween(2,r.minus(2)).modPow(r.prev(),r).isUnit())return!1}return!0},o.prototype.isProbablePrime=i.prototype.isProbablePrime,i.prototype.modInv=function(t){for(var e,r,n,i=bigInt.zero,o=bigInt.one,a=q(t),s=this.abs();!s.equals(bigInt.zero);)e=a.divide(s),r=i,n=a,i=o,a=s,o=r.subtract(e.multiply(o)),s=n.subtract(e.multiply(s));if(!a.equals(1))throw new Error(this.toString()+" and "+t.toString()+" are not co-prime");return-1===i.compare(0)&&(i=i.add(t)),this.isNegative()?i.negate():i},o.prototype.modInv=i.prototype.modInv,i.prototype.next=function(){var t=this.value;return this.sign?y(t,1,this.sign):new i(_(t,1),this.sign)},o.prototype.next=function(){var t=this.value;return t+1<z?new o(t+1):new i(H,!1)},i.prototype.prev=function(){var t=this.value;return this.sign?new i(_(t,1),!0):y(t,1,this.sign)},o.prototype.prev=function(){var t=this.value;return t-1>-z?new o(t-1):new i(H,!0)};for(var Z=[1];Z[Z.length-1]<=J;)Z.push(2*Z[Z.length-1]);var Q=Z.length,X=Z[Q-1];i.prototype.shiftLeft=function(t){if(!C(t))throw new Error(String(t)+" is too large for shifting.");if((t=+t)<0)return this.shiftRight(-t);for(var e=this;t>=Q;)e=e.multiply(X),t-=Q-1;return e.multiply(Z[t])},o.prototype.shiftLeft=i.prototype.shiftLeft,i.prototype.shiftRight=function(t){var e;if(!C(t))throw new Error(String(t)+" is too large for shifting.");if((t=+t)<0)return this.shiftLeft(-t);for(var r=this;t>=Q;){if(r.isZero())return r;e=N(r,X),r=e[1].isNegative()?e[0].prev():e[0],t-=Q-1}return e=N(r,Z[t]),e[1].isNegative()?e[0].prev():e[0]},o.prototype.shiftRight=i.prototype.shiftRight,i.prototype.not=function(){return this.negate().prev()},o.prototype.not=i.prototype.not,i.prototype.and=function(t){return O(this,t,function(t,e){return t&e})},o.prototype.and=i.prototype.and,i.prototype.or=function(t){return O(this,t,function(t,e){return t|e})},o.prototype.or=i.prototype.or,i.prototype.xor=function(t){return O(this,t,function(t,e){return t^e})},o.prototype.xor=i.prototype.xor;var $=1<<30,tt=(J&-J)*(J&-J)|$,et=function(t,e){for(var r,n=t.length,i=Math.abs(e),r=0;r<n;r++){var a=t[r].toLowerCase();if("-"!==a&&/[a-z0-9]/.test(a)){if(/[0-9]/.test(a)&&+a>=i){if("1"===a&&1===i)continue;throw new Error(a+" is not a valid digit in base "+e+".")}if(a.charCodeAt(0)-87>=i)throw new Error(a+" is not a valid digit in base "+e+".")}}if(2<=e&&e<=36&&n<=K/Math.log(e)){var s=parseInt(t,e);if(isNaN(s))throw new Error(a+" is not a valid digit in base "+e+".");return new o(parseInt(t,e))}e=q(e);var u=[],c="-"===t[0];for(r=c?1:0;r<t.length;r++){var a=t[r].toLowerCase(),l=a.charCodeAt(0);if(48<=l&&l<=57)u.push(q(a));else if(97<=l&&l<=122)u.push(q(a.charCodeAt(0)-87));else{if("<"!==a)throw new Error(a+" is not a valid character");var h=r;do{r++}while(">"!==t[r]);u.push(q(t.slice(h+1,r)))}}return B(u,e,c)};i.prototype.toString=function(t){if(void 0===t&&(t=10),10!==t)return U(this,t);for(var e,r=this.value,n=r.length,i=String(r[--n]),o="0000000";--n>=0;)e=String(r[n]),i+=o.slice(e.length)+e;return(this.sign?"-":"")+i},o.prototype.toString=function(t){return void 0===t&&(t=10),10!=t?U(this,t):String(this.value)},i.prototype.valueOf=function(){return+this.toString()},i.prototype.toJSNumber=i.prototype.valueOf,o.prototype.valueOf=function(){return this.value},o.prototype.toJSNumber=o.prototype.valueOf;for(var rt=0;rt<1e3;rt++)n[rt]=new o(rt),rt>0&&(n[-rt]=new o(-rt));n.one=n[1],n.zero=n[0],n.minusOne=n[-1],n.max=L,n.min=F,n.gcd=D,n.lcm=M,n.isInstance=function(t){return t instanceof i||t instanceof o},n.randBetween=V,n.fromArray=function(t,e,r){return B(t.map(q),q(e||10),r)}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return new p.Token(t,e,f.UnknownPosition,f.UnknownPosition)}Object.defineProperty(e,"__esModule",{value:!0}),e.Runner=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(12),s=r(14),u=r(7),c=r(15),l=r(3),h=r(16),f=r(5),p=r(6),_=r(2);e.Runner=function(){function t(){n(this,t),this.initialize()}return o(t,[{key:"initialize",value:function(){this._ast=null,this._primitives=new l.RuntimePrimitives,this._symtable=this._newSymtableWithPrimitives(),this._linter=new s.Linter(this._symtable),this._code=null,this._vm=null,this._result=null}},{key:"run",value:function(t){return this.runState(t,new l.RuntimeState).result}},{key:"runState",value:function(t,e){return this.parse(t),this.lint(),this.compile(),this.execute(e),{result:this._result,state:this._vm.globalState()}}},{key:"parse",value:function(t){this._ast=new a.Parser(t).parse()}},{key:"enableLintCheck",value:function(t,e){this._linter.enableCheck(t,e)}},{key:"lint",value:function(){this._symtable=this._linter.lint(this._ast)}},{key:"compile",value:function(){this._code=new c.Compiler(this._symtable).compile(this._ast)}},{key:"initializeVirtualMachine",value:function(t){this._vm=new h.VirtualMachine(this._code,t)}},{key:"execute",value:function(t){this.executeWithTimeout(t,0)}},{key:"executeWithTimeout",value:function(t,e){this.executeWithTimeoutTakingSnapshots(t,e,null)}},{key:"executeWithTimeoutTakingSnapshots",value:function(t,e,r){this.initializeVirtualMachine(t),this._result=this._vm.runWithTimeoutTakingSnapshots(e,r)}},{key:"executeEventWithTimeout",value:function(t,e){this._result=this._vm.runEventWithTimeout(t,e)}},{key:"_newSymtableWithPrimitives",value:function(){var t=new u.SymbolTable,e=!0,r=!1,n=void 0;try{for(var i,o=this._primitives.types()[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;t.defType(this._astDefType(a))}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}var s=!0,c=!1,l=void 0;try{for(var h,f=this._primitives.procedures()[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var p=h.value;t.defProcedure(this._astDefProcedure(p))}}catch(t){c=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(c)throw l}}var _=!0,m=!1,d=void 0;try{for(var y,v=this._primitives.functions()[Symbol.iterator]();!(_=(y=v.next()).done);_=!0){var g=y.value;t.defFunction(this._astDefFunction(g))}}catch(t){m=!0,d=t}finally{try{!_&&v.return&&v.return()}finally{if(m)throw d}}return t}},{key:"_astDefType",value:function(t){var e=[],r=!0,n=!1,o=void 0;try{for(var a,s=this._primitives.typeConstructors(t)[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;e.push(this._astConstructorDeclaration(t,u))}}catch(t){n=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return new _.ASTDefType(i(p.T_UPPERID,t),e)}},{key:"_astDefProcedure",value:function(t){for(var e=this._primitives.getOperation(t).nargs(),r=[],n=1;n<=e;n++)r.push(i(p.T_LOWERID,"x"+n.toString()));return new _.ASTDefProcedure(i(p.T_LOWERID,t),r,new _.ASTStmtBlock([]))}},{key:"_astDefFunction",value:function(t){for(var e=this._primitives.getOperation(t).nargs(),r=[],n=1;n<=e;n++)r.push(i(p.T_LOWERID,"x"+n.toString()));return new _.ASTDefFunction(i(p.T_LOWERID,t),r,new _.ASTStmtBlock([]))}},{key:"_astConstructorDeclaration",value:function(t,e){var r=[],n=!0,o=!1,a=void 0;try{for(var s,u=this._primitives.constructorFields(t,e)[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var c=s.value;r.push(i(p.T_LOWERID,c))}}catch(t){o=!0,a=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw a}}return new _.ASTConstructorDeclaration(i(p.T_UPPERID,e),r)}},{key:"abstractSyntaxTree",get:function(){return this._ast}},{key:"primitives",get:function(){return this._primitives}},{key:"symbolTable",get:function(){return this._symtable}},{key:"virtualMachineCode",get:function(){return this._code}},{key:"result",get:function(){return this._result}},{key:"globalState",get:function(){return this._vm.globalState()}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,r,n){throw new a.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=void 0;var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),a=r(1),s=r(13),u=r(0),c=r(6),l=r(2),h=Symbol.for("Infix"),f=Symbol.for("InfixL"),p=Symbol.for("InfixR"),_=Symbol.for("Prefix"),m=function(){function t(e,r){n(this,t),this._fixity=e,this._operators=r}return o(t,[{key:"isOperator",value:function(t){return Symbol.keyFor(t.tag)in this._operators}},{key:"functionName",value:function(t){return new c.Token(c.T_LOWERID,this._operators[Symbol.keyFor(t.tag)],t.startPos,t.endPos)}},{key:"fixity",get:function(){return this._fixity}}]),t}(),d=[new m(p,{T_OR:"||"}),new m(p,{T_AND:"&&"}),new m(_,{T_NOT:"not"}),new m(h,{T_EQ:"==",T_NE:"/=",T_LE:"<=",T_GE:">=",T_LT:"<",T_GT:">"}),new m(f,{T_CONCAT:"++"}),new m(f,{T_PLUS:"+",T_MINUS:"-"}),new m(f,{T_TIMES:"*"}),new m(f,{T_DIV:"div",T_MOD:"mod"}),new m(p,{T_POW:"^"}),new m(_,{T_MINUS:"-(unary)"})];e.Parser=function(){function t(e){n(this,t),this._lexer=new s.Lexer(e),this._nextToken()}return o(t,[{key:"parse",value:function(){for(var t=[];this._currentToken.tag!==c.T_EOF;)t.push(this._parseDefinition());return new l.ASTMain(t)}},{key:"_parseDefinition",value:function(){switch(this._currentToken.tag){case c.T_PROGRAM:return this._parseDefProgram();case c.T_INTERACTIVE:return this._parseDefInteractiveProgram();case c.T_PROCEDURE:return this._parseDefProcedure();case c.T_FUNCTION:return this._parseDefFunction();case c.T_TYPE:return this._parseDefType();default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("definition"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseDefProgram",value:function(){var t=this._currentToken.startPos;this._match(c.T_PROGRAM);var e=this._parseStmtBlock(),r=new l.ASTDefProgram(e);return r.startPos=t,r.endPos=e.endPos,r}},{key:"_parseDefInteractiveProgram",value:function(){var t=this._currentToken.startPos;this._match(c.T_INTERACTIVE),this._match(c.T_PROGRAM),this._match(c.T_LBRACE);var e=this._parseSwitchBranches(),r=this._currentToken.startPos;this._match(c.T_RBRACE);var n=new l.ASTDefInteractiveProgram(e);return n.startPos=t,n.endPos=r,n}},{key:"_parseDefProcedure",value:function(){var t=this._currentToken.startPos;this._match(c.T_PROCEDURE);var e=this._parseUpperid();this._match(c.T_LPAREN);var r=this._parseLoweridSeq();this._match(c.T_RPAREN);var n=this._parseStmtBlock(),i=new l.ASTDefProcedure(e,r,n);return i.startPos=t,i.endPos=n.endPos,i}},{key:"_parseDefFunction",value:function(){var t=this._currentToken.startPos;this._match(c.T_FUNCTION);var e=this._currentToken;this._match(c.T_LOWERID),this._match(c.T_LPAREN);var r=this._parseLoweridSeq();this._match(c.T_RPAREN);var n=this._parseStmtBlock(),i=new l.ASTDefFunction(e,r,n);return i.startPos=t,i.endPos=n.endPos,i}},{key:"_parseDefType",value:function(){var t=this._currentToken.startPos;this._match(c.T_TYPE);var e=this._parseUpperid();switch(this._match(c.T_IS),this._currentToken.tag){case c.T_RECORD:return this._parseDefTypeRecord(t,e);case c.T_VARIANT:return this._parseDefTypeVariant(t,e);default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_RECORD"),(0,u.i18n)("T_VARIANT")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseDefTypeRecord",value:function(t,e){this._match(c.T_RECORD),this._match(c.T_LBRACE);var r=this._parseFieldNames(),n=this._currentToken.startPos;this._matchExpected(c.T_RBRACE,[c.T_FIELD,c.T_RBRACE]);var i=new l.ASTDefType(e,[new l.ASTConstructorDeclaration(e,r)]);return i.startPos=t,i.endPos=n,i}},{key:"_parseDefTypeVariant",value:function(t,e){var r=[];for(this._match(c.T_VARIANT),this._match(c.T_LBRACE);this._currentToken.tag===c.T_CASE;)r.push(this._parseConstructorDeclaration());var n=this._currentToken.startPos;this._matchExpected(c.T_RBRACE,[c.T_CASE,c.T_RBRACE]);var i=new l.ASTDefType(e,r);return i.startPos=t,i.endPos=n,i}},{key:"_parseConstructorDeclaration",value:function(){var t=this._currentToken.startPos;this._match(c.T_CASE);var e=this._parseUpperid();this._match(c.T_LBRACE);var r=this._parseFieldNames(),n=this._currentToken.startPos;this._matchExpected(c.T_RBRACE,[c.T_FIELD,c.T_RBRACE]);var i=new l.ASTConstructorDeclaration(e,r);return i.startPos=t,i.endPos=n,i}},{key:"_parseFieldNames",value:function(){for(var t=[];this._currentToken.tag===c.T_FIELD;)this._match(c.T_FIELD),t.push(this._parseLowerid());return t}},{key:"_parseStatement",value:function(){var t=this._parsePureStatement();return this._currentToken.tag===c.T_SEMICOLON&&this._match(c.T_SEMICOLON),t}},{key:"_parsePureStatement",value:function(){switch(this._currentToken.tag){case c.T_RETURN:return this._parseStmtReturn();case c.T_IF:return this._parseStmtIf();case c.T_REPEAT:return this._parseStmtRepeat();case c.T_FOREACH:return this._parseStmtForeach();case c.T_WHILE:return this._parseStmtWhile();case c.T_SWITCH:return this._parseStmtSwitch();case c.T_LET:return this._parseStmtLet();case c.T_LBRACE:return this._parseStmtBlock();case c.T_LOWERID:return this._parseStmtAssignVariable();case c.T_UPPERID:return this._parseStmtProcedureCall();case c.T_LPAREN:return i(this._currentToken.startPos,this._currentToken.endPos,"obsolete-tuple-assignment",[]);default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("statement"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseStmtBlock",value:function(){var t=this._currentToken.startPos,e=[];for(this._match(c.T_LBRACE);this._currentToken.tag!==c.T_RBRACE;)e.push(this._parseStatement()),this._currentToken===c.T_SEMICOLON&&this._match(c.T_SEMICOLON);var r=this._currentToken.startPos;this._match(c.T_RBRACE);var n=new l.ASTStmtBlock(e);return n.startPos=t,n.endPos=r,n}},{key:"_parseStmtReturn",value:function(){var t=this._currentToken.startPos;this._match(c.T_RETURN);var e=this._parseExprTuple(),r=new l.ASTStmtReturn(e);return r.startPos=t,r.endPos=e.endPos,r}},{key:"_parseStmtIf",value:function(){var t=this._currentToken.startPos;this._match(c.T_IF),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN),this._currentToken.tag===c.T_THEN&&this._match(c.T_THEN);var r=this._parseStmtBlock(),n=void 0,i=void 0;this._currentToken.tag===c.T_ELSE?(this._match(c.T_ELSE),i=this._parseStmtBlock(),n=i.endPos):(i=null,n=r.endPos);var o=new l.ASTStmtIf(e,r,i);return o.startPos=t,o.endPos=n,o}},{key:"_parseStmtRepeat",value:function(){var t=this._currentToken.startPos;this._match(c.T_REPEAT),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN);var r=this._parseStmtBlock(),n=new l.ASTStmtRepeat(e,r);return n.startPos=t,n.endPos=r.endPos,n}},{key:"_parseStmtForeach",value:function(){var t=this._currentToken.startPos;this._match(c.T_FOREACH);var e=this._parseLowerid();this._match(c.T_IN);var r=this._parseExpression(),n=this._parseStmtBlock(),i=new l.ASTStmtForeach(e,r,n);return i.startPos=t,i.endPos=n.endPos,i}},{key:"_parseStmtWhile",value:function(){var t=this._currentToken.startPos;this._match(c.T_WHILE),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN);var r=this._parseStmtBlock(),n=new l.ASTStmtWhile(e,r);return n.startPos=t,n.endPos=r.endPos,n}},{key:"_parseStmtSwitch",value:function(){var t=this._currentToken.startPos;this._match(c.T_SWITCH),this._match(c.T_LPAREN);var e=this._parseExpression();this._match(c.T_RPAREN),this._currentToken.tag===c.T_TO&&this._match(c.T_TO),this._match(c.T_LBRACE);var r=this._parseSwitchBranches(),n=this._currentToken.startPos;this._match(c.T_RBRACE);var i=new l.ASTStmtSwitch(e,r);return i.startPos=t,i.endPos=n,i}},{key:"_parseStmtLet",value:function(){var t=this._currentToken.startPos;this._match(c.T_LET);var e=void 0;return this._currentToken.tag===c.T_LOWERID?e=this._parseStmtAssignVariable():this._currentToken.tag===c.T_LPAREN?e=this._parseStmtAssignTuple():i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")((0,u.i18n)("T_LOWERID"),(0,u.i18n)("T_LPAREN")),(0,u.i18n)(Symbol.keyfor(this._currentToken.tag))]),e.startPos=t,e}},{key:"_parseStmtAssignVariable",value:function(){var t=this._parseLowerid();this._match(c.T_ASSIGN);var e=this._parseExpression(),r=new l.ASTStmtAssignVariable(t,e);return r.startPos=t.startPos,r.endPos=e.endPos,r}},{key:"_parseStmtAssignTuple",value:function(){var t=this._currentToken.startPos;this._match(c.T_LPAREN);var e=this._parseLoweridSeq();1===e.length&&i(t,this._currentToken.endPos,"assignment-tuple-cannot-be-singleton",[]),this._match(c.T_RPAREN),this._match(c.T_ASSIGN);var r=this._parseExpression(),n=new l.ASTStmtAssignTuple(e,r);return n.startPos=t,n.endPos=r.endPos,n}},{key:"_parseStmtProcedureCall",value:function(){var t=this,e=this._parseUpperid();this._match(c.T_LPAREN);var r=this._parseDelimitedSeq(c.T_RPAREN,c.T_COMMA,function(){return t._parseExpression()}),n=this._currentToken.startPos;this._match(c.T_RPAREN);var i=new l.ASTStmtProcedureCall(e,r);return i.startPos=e.startPos,i.endPos=n,i}},{key:"_parsePattern",value:function(){switch(this._currentToken.tag){case c.T_UNDERSCORE:return this._parsePatternWildcard();case c.T_UPPERID:return this._parsePatternStructure();case c.T_LPAREN:return this._parsePatternTuple();case c.T_TIMEOUT:return this._parsePatternTimeout();default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("pattern"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parsePatternWildcard",value:function(){var t=this._currentToken.startPos;this._match(c.T_UNDERSCORE);var e=new l.ASTPatternWildcard,r=t;return e.startPos=t,e.endPos=r,e}},{key:"_parsePatternStructure",value:function(){var t=this._currentToken.startPos,e=this._currentToken.startPos,r=this._parseUpperid(),n=void 0;this._currentToken.tag===c.T_LPAREN?(this._match(c.T_LPAREN),n=this._parseLoweridSeq(),e=this._currentToken.startPos,this._match(c.T_RPAREN)):n=[];var i=new l.ASTPatternStructure(r,n);return i.startPos=t,i.endPos=e,i}},{key:"_parsePatternTuple",value:function(){var t=this._currentToken.startPos;this._match(c.T_LPAREN);var e=this._parseLoweridSeq();1===e.length&&i(t,this._currentToken.endPos,"pattern-tuple-cannot-be-singleton",[]);var r=this._currentToken.startPos;this._match(c.T_RPAREN);var n=new l.ASTPatternTuple(e);return n.startPos=t,n.endPos=r,n}},{key:"_parsePatternTimeout",value:function(){var t=this._currentToken.startPos;this._match(c.T_TIMEOUT),this._match(c.T_LPAREN);var e=this._currentToken;this._match(c.T_NUM);var r=this._currentToken.startPos;this._match(c.T_RPAREN);var n=new l.ASTPatternTimeout(e);return n.startPos=t,n.endPos=r,n}},{key:"_parseExpression",value:function(){return this._parseExprOperator(0)}},{key:"_parseExprOperator",value:function(t){if(t===d.length)return this._parseExprAtom();switch(d[t].fixity){case h:return this._parseExprOperatorInfix(t);case f:return this._parseExprOperatorInfixL(t);case p:return this._parseExprOperatorInfixR(t);case _:return this._parseExprOperatorPrefix(t);default:throw Error("Invalid operator.")}}},{key:"_parseExprOperatorInfix",value:function(t){var e=this._parseExprOperator(t+1);if(d[t].isOperator(this._currentToken)){var r=this._currentToken;this._nextToken();var n=this._parseExprOperator(t+1);d[t].isOperator(this._currentToken)&&i(this._currentToken.startPos,this._currentToken.endPos,"operators-are-not-associative",[(0,u.i18n)(Symbol.keyFor(r.tag)),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]);var o=new l.ASTExprFunctionCall(d[t].functionName(r),[e,n]);return o.startPos=e.startPos,o.endPos=n.endPos,o}return e}},{key:"_parseExprOperatorInfixL",value:function(t){for(var e=this._parseExprOperator(t+1);d[t].isOperator(this._currentToken);){var r=this._currentToken;this._nextToken();var n=this._parseExprOperator(t+1),i=new l.ASTExprFunctionCall(d[t].functionName(r),[e,n]);i.startPos=e.startPos,i.endPos=n.endPos,e=i}return e}},{key:"_parseExprOperatorInfixR",value:function(t){var e=this._parseExprOperator(t+1);if(d[t].isOperator(this._currentToken)){var r=this._currentToken;this._nextToken();var n=this._parseExprOperator(t),i=new l.ASTExprFunctionCall(d[t].functionName(r),[e,n]);return i.startPos=e.startPos,i.endPos=n.endPos,i}return e}},{key:"_parseExprOperatorPrefix",value:function(t){if(d[t].isOperator(this._currentToken)){var e=this._currentToken;this._nextToken();var r=this._parseExprOperator(t),n=new l.ASTExprFunctionCall(d[t].functionName(e),[r]);return n.startPos=e.startPos,n.endPos=r.endPos,n}return this._parseExprOperator(t+1)}},{key:"_parseExprAtom",value:function(){switch(this._currentToken.tag){case c.T_LOWERID:return this._parseExprVariableOrFunctionCall();case c.T_NUM:return this._parseExprConstantNumber();case c.T_STRING:return this._parseExprConstantString();case c.T_UPPERID:return this._parseExprStructureOrStructureUpdate();case c.T_LPAREN:return this._parseExprTuple();case c.T_LBRACK:return this._parseExprListOrRange();default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("expression"),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseExprVariableOrFunctionCall",value:function(){var t=this._parseLowerid(),e=void 0,r=void 0;if(this._currentToken.tag===c.T_LPAREN){this._match(c.T_LPAREN);var n=this._parseExpressionSeq(c.T_RPAREN);e=new l.ASTExprFunctionCall(t,n),r=this._currentToken.startPos,this._match(c.T_RPAREN)}else e=new l.ASTExprVariable(t),r=t.endPos;return e.startPos=t.startPos,e.endPos=r,e}},{key:"_parseExprConstantNumber",value:function(){var t=this._currentToken;this._match(c.T_NUM);var e=new l.ASTExprConstantNumber(t);return e.startPos=t.startPos,e.endPos=t.endPos,e}},{key:"_parseExprConstantString",value:function(){var t=this._currentToken;this._match(c.T_STRING);var e=new l.ASTExprConstantString(t);return e.startPos=t.startPos,e.endPos=t.endPos,e}},{key:"_parseExprStructureOrStructureUpdate",value:function(){var t=this._parseUpperid();if(this._currentToken.tag!==c.T_LPAREN){var e=new l.ASTExprStructure(t,[]);return e.startPos=t.startPos,e.endPos=t.endPos,e}if(this._match(c.T_LPAREN),this._currentToken.tag===c.T_RPAREN){var r=new l.ASTExprStructure(t,[]),n=this._currentToken.startPos;return this._match(c.T_RPAREN),r.startPos=t.startPos,r.endPos=n,r}var o=this._parseExpression();switch(this._currentToken.tag){case c.T_GETS:return o.tag!==l.N_ExprVariable&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("T_PIPE"),(0,u.i18n)("T_GETS")]),this._parseStructure(t,o.variableName);case c.T_PIPE:return this._parseStructureUpdate(t,o);case c.T_COMMA:case c.T_RPAREN:return i(t.startPos,t.endPos,"expected-but-found",[(0,u.i18n)("expression"),(0,u.i18n)("procedure call")]);default:var a=void 0;return a=o.tag===l.N_ExprVariable?(0,u.i18n)("<alternative>")([(0,u.i18n)("T_GETS"),(0,u.i18n)("T_PIPE")]):(0,u.i18n)("T_PIPE"),i(t.startPos,t.endPos,"expected-but-found",[a,(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseStructure",value:function(t,e){var r=this;this._match(c.T_GETS);var n=this._parseExpression(),i=new l.ASTFieldBinding(e,n);i.startPos=e.startPos,i.endPos=n.endPos;var o=this._parseNonEmptyDelimitedSeq(c.T_RPAREN,c.T_COMMA,[i],function(){return r._parseFieldBinding()}),a=this._currentToken.startPos;this._match(c.T_RPAREN);var s=new l.ASTExprStructure(t,o);return s.startPos=t.startPos,s.endPos=a,s}},{key:"_parseStructureUpdate",value:function(t,e){var r=this;this._match(c.T_PIPE);var n=this._parseDelimitedSeq(c.T_RPAREN,c.T_COMMA,function(){return r._parseFieldBinding()}),i=this._currentToken.startPos;this._match(c.T_RPAREN);var o=new l.ASTExprStructureUpdate(t,e,n);return o.startPos=t.startPos,o.endPos=i,o}},{key:"_parseExprListOrRange",value:function(){var t=this._currentToken.startPos;if(this._match(c.T_LBRACK),this._currentToken.tag===c.T_RBRACK)return this._parseExprListRemainder(t,[]);var e=this._parseExpression();switch(this._currentToken.tag){case c.T_RBRACK:return this._parseExprListRemainder(t,[e]);case c.T_RANGE:return this._parseExprRange(t,e,null);case c.T_COMMA:this._match(c.T_COMMA);var r=this._parseExpression();switch(this._currentToken.tag){case c.T_RBRACK:case c.T_COMMA:return this._parseExprListRemainder(t,[e,r]);case c.T_RANGE:return this._parseExprRange(t,e,r);default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_COMMA"),(0,u.i18n)("T_RANGE"),(0,u.i18n)("T_RBRACK")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}default:return i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)("T_COMMA"),(0,u.i18n)("T_RANGE"),(0,u.i18n)("T_RBRACK")]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))])}}},{key:"_parseExprListRemainder",value:function(t,e){var r=this,n=this._parseNonEmptyDelimitedSeq(c.T_RBRACK,c.T_COMMA,e,function(){return r._parseExpression()}),i=this._currentToken.startPos;this._match(c.T_RBRACK);var o=new l.ASTExprList(n);return o.startPos=t,o.endPos=i,o}},{key:"_parseExprRange",value:function(t,e,r){this._match(c.T_RANGE);var n=this._parseExpression(),i=this._currentToken.startPos;this._match(c.T_RBRACK);var o=new l.ASTExprRange(e,r,n);return o.startPos=t,o.endPos=i,o}},{key:"_parseExprTuple",value:function(){var t=this._currentToken.startPos;this._match(c.T_LPAREN);var e=this._parseExpressionSeq(c.T_RPAREN),r=this._currentToken.startPos;this._match(c.T_RPAREN);var n=void 0;return n=1===e.length?e[0]:new l.ASTExprTuple(e),n.startPos=t,n.endPos=r,n}},{key:"_parseSwitchBranches",value:function(){for(var t=[];this._currentToken.tag!==c.T_RBRACE;)t.push(this._parseSwitchBranch());return t}},{key:"_parseSwitchBranch",value:function(){var t=this._parsePattern();this._match(c.T_ARROW);var e=this._parseStmtBlock(),r=new l.ASTSwitchBranch(t,e);return r.startPos=t.startPos,r.endPos=e.endPos,r}},{key:"_parseFieldBinding",value:function(){var t=this._parseLowerid();this._match(c.T_GETS);var e=this._parseExpression(),r=new l.ASTFieldBinding(t,e);return r.startPos=t.startPos,r.endPos=e.endPos,r}},{key:"_nextToken",value:function(){this._currentToken=this._lexer.nextToken()}},{key:"_match",value:function(t){this._currentToken.tag!==t&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)(Symbol.keyFor(t)),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]),this._nextToken()}},{key:"_matchExpected",value:function(t,e){this._currentToken.tag!==t&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")(e.map(function(t){return(0,u.i18n)(Symbol.keyFor(t))})),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]),this._nextToken()}},{key:"_parseDelimitedSeq",value:function(t,e,r){if(this._currentToken.tag===t)return[];var n=r();return this._parseNonEmptyDelimitedSeq(t,e,[n],r)}},{key:"_parseNonEmptyDelimitedSeq",value:function(t,e,r,n){for(var o=r;this._currentToken.tag===e;)this._match(e),o.push(n());return this._currentToken.tag!==t&&i(this._currentToken.startPos,this._currentToken.endPos,"expected-but-found",[(0,u.i18n)("<alternative>")([(0,u.i18n)(Symbol.keyFor(e)),(0,u.i18n)(Symbol.keyFor(t))]),(0,u.i18n)(Symbol.keyFor(this._currentToken.tag))]),o}},{key:"_parseLowerid",value:function(){var t=this._currentToken;return this._match(c.T_LOWERID),t}},{key:"_parseUpperid",value:function(){var t=this._currentToken;return this._match(c.T_UPPERID),t}},{key:"_parseLoweridSeq",value:function(){var t=this;return this._parseDelimitedSeq(c.T_RPAREN,c.T_COMMA,function(){return t._parseLowerid()})}},{key:"_parseExpressionSeq",value:function(t){var e=this;return this._parseDelimitedSeq(t,c.T_COMMA,function(){return e._parseExpression()})}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return" "===t||"\t"===t||"\r"===t||"\n"===t}function o(t){return"0"<=t&&t<="9"}function a(t){return t.toUpperCase(t)!==t.toLowerCase()}function s(t){return a(t)&&t.toUpperCase()===t}function u(t){return a(t)&&t.toLowerCase()===t}function c(t){return a(t)||o(t)||"_"===t||"'"===t}function l(t){return t.length>=0&&"0"===t[0]}function h(t,e,r,n){throw new m.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.Lexer=void 0;var f=function(){function t(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_=r(0),m=r(1),d=r(5),y=r(6),v={program:y.T_PROGRAM,interactive:y.T_INTERACTIVE,procedure:y.T_PROCEDURE,function:y.T_FUNCTION,return:y.T_RETURN,if:y.T_IF,then:y.T_THEN,else:y.T_ELSE,repeat:y.T_REPEAT,foreach:y.T_FOREACH,in:y.T_IN,while:y.T_WHILE,switch:y.T_SWITCH,match:y.T_SWITCH,to:y.T_TO,let:y.T_LET,not:y.T_NOT,div:y.T_DIV,mod:y.T_MOD,type:y.T_TYPE,is:y.T_IS,record:y.T_RECORD,variant:y.T_VARIANT,case:y.T_CASE,field:y.T_FIELD,_:y.T_UNDERSCORE};v[(0,_.i18n)("CONS:TIMEOUT")]=y.T_TIMEOUT;var g=[["(",y.T_LPAREN],[")",y.T_RPAREN],["{",y.T_LBRACE],["}",y.T_RBRACE],["[",y.T_LBRACK],["]",y.T_RBRACK],[",",y.T_COMMA],[";",y.T_SEMICOLON],["..",y.T_RANGE],[":=",y.T_ASSIGN],["&&",y.T_AND],["||",y.T_OR],["<-",y.T_GETS],["|",y.T_PIPE],["->",y.T_ARROW],["==",y.T_EQ],["/=",y.T_NE],["<=",y.T_LE],[">=",y.T_GE],["<",y.T_LT],[">",y.T_GT],["++",y.T_CONCAT],["+",y.T_PLUS],["-",y.T_MINUS],["*",y.T_TIMES],["^",y.T_POW]];e.Lexer=function(){function t(e){n(this,t),this._multifileReader=new d.MultifileReader(e),this._reader=this._multifileReader.readCurrentFile(),this._warnings=[]}return p(t,[{key:"nextToken",value:function(){if(!this._findNextToken())return new y.Token(y.T_EOF,null,this._reader,this._reader);if(o(this._reader.peek())){var t=this._reader,e=this._readStringWhile(o),r=this._reader;return l(e)&&e.length>1?h(t,r,"numeric-constant-should-not-have-leading-zeroes",[]):new y.Token(y.T_NUM,e,t,r)}if(c(this._reader.peek())){var n=this._reader,i=this._readStringWhile(c),a=this._reader;return i in v?new y.Token(v[i],i,n,a):s(i[0])?new y.Token(y.T_UPPERID,i,n,a):u(i[0])?new y.Token(y.T_LOWERID,i,n,a):h(n,a,"identifier-must-start-with-alphabetic-character",[])}return'"'===this._reader.peek()?this._readStringConstant():this._readSymbol()}},{key:"warnings",value:function(){return this._warnings}},{key:"_findNextToken",value:function(){for(;this._ignoreWhitespaceAndComments(),this._reader.eof();){if(!this._multifileReader.moreFiles())return!1;this._multifileReader.nextFile(),this._reader=this._multifileReader.readCurrentFile()}return!0}},{key:"_readStringWhile",value:function(t){for(var e=[];!this._reader.eof()&&t(this._reader.peek());)e.push(this._reader.peek()),this._reader=this._reader.consumeCharacter();return e.join("")}},{key:"_readStringConstant",value:function(){var t=this._reader,e=[];for(this._reader=this._reader.consumeCharacter();!this._reader.eof();){var r=this._reader.peek();if('"'===r)return this._reader=this._reader.consumeCharacter(),new y.Token(y.T_STRING,e.join(""),t,this._reader);if("\\"===r){if(this._reader=this._reader.consumeCharacter(),this._reader.eof())break;var n=this._reader.peek();switch(this._reader=this._reader.consumeCharacter(),n){case"a":e.push("");break;case"b":e.push("\b");break;case"f":e.push("\f");break;case"n":e.push("\n");break;case"r":e.push("\r");break;case"t":e.push("\t");break;case"v":e.push("\v");break;default:e.push(n)}}else e.push(r),this._reader=this._reader.consumeCharacter()}return h(t,this._reader,"unclosed-string-constant",[])}},{key:"_readSymbol",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=g[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){var o=f(n.value,2),a=o[0],s=o[1];if(this._reader.startsWith(a)){var u=this._reader;this._reader=this._reader.consumeString(a);var c=this._reader;return new y.Token(s,a,u,c)}}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}return h(this._reader,this._reader,"unknown-token",[this._reader.peek()])}},{key:"_ignoreWhitespaceAndComments",value:function(){for(;this._ignoreWhitespace()||this._ignoreComments(););}},{key:"_ignoreWhitespace",value:function(){return!(this._reader.eof()||!i(this._reader.peek()))&&(this._reader=this._reader.consumeCharacter(),!0)}},{key:"_ignoreComments",value:function(){if(this._startSingleLineComment())return this._ignoreSingleLineComment(),!0;if(this._reader.startsWith("/*@")){var t=this._reader;return this._evaluatePragma(t,this._readInvisiblePragma("/*","*/","@")),!0}return this._reader.startsWith("{-")?(this._ignoreMultilineComment("{-","-}"),!0):!!this._reader.startsWith("/*")&&(this._ignoreMultilineComment("/*","*/"),!0)}},{key:"_startSingleLineComment",value:function(){return this._reader.startsWith("--")||this._reader.startsWith("//")||this._reader.startsWith("#")}},{key:"_ignoreSingleLineComment",value:function(){for(;!this._reader.eof()&&(this._reader=this._reader.consumeCharacter(),"\n"!==this._reader.peek()););}},{key:"_ignoreMultilineComment",value:function(t,e){for(var r=0,n=this._reader;!this._reader.eof();)if(this._reader.startsWith(t))this._reader=this._reader.consumeString(t),r++;else if(this._reader.startsWith(e)){if(this._reader=this._reader.consumeString(e),0===--r)return}else this._reader=this._reader.consumeCharacter();h(n,this._reader,"unclosed-multiline-comment",[])}},{key:"_readInvisiblePragma",value:function(t,e,r){var n=[],i=this._reader;for(this._reader=this._reader.consumeInvisibleString(t),this._reader=this._reader.consumeInvisibleString(r);!this._reader.eof();)if(n.push(this._readInvisibleStringUntilDelimiter(r)),this._reader=this._reader.consumeInvisibleString(r),this._reader.startsWith(e))return this._reader=this._reader.consumeInvisibleString(e),n;return h(i,this._reader,"unclosed-multiline-comment",[])}},{key:"_readInvisibleStringUntilDelimiter",value:function(t){for(var e=this._reader,r=[];!this._reader.eof();){if(this._reader.peek()===t)return r.join("");r.push(this._reader.peek()),this._reader=this._reader.consumeInvisibleCharacter()}return h(e,this._reader,"unclosed-multiline-comment",[])}},{key:"_evaluatePragma",value:function(t,e){if(0===e.length)this._emitWarning(t,this._reader,"empty-pragma",[]);else if("BEGIN_REGION"===e[0]){var r=e[1];this._reader=this._reader.beginRegion(r)}else"END_REGION"===e[0]?this._reader=this._reader.endRegion():this._emitWarning(t,this._reader,"unknown-pragma",[e[0]])}},{key:"_emitWarning",value:function(t,e,r,n){this._warnings.push(new m.GbsWarning(t,e,r,n))}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return t.tag===s.N_StmtBlock&&t.statements.length>0&&t.statements.slice(-1)[0].tag===s.N_StmtReturn}function o(t,e,r,n){throw new c.GbsSyntaxError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.Linter=void 0;var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),s=r(2),u=r(7),c=r(1),l=r(0);e.Linter=function(){function t(e){n(this,t),this._symtable=e,this._enabledLinterChecks={"source-should-have-a-program-definition":!0,"procedure-should-not-have-return":!0,"function-should-have-return":!0,"return-statement-not-allowed-here":!0,"wildcard-pattern-should-be-last":!0,"structure-pattern-repeats-constructor":!0,"structure-pattern-repeats-tuple-arity":!0,"structure-pattern-repeats-timeout":!0,"pattern-does-not-match-type":!0,"patterns-in-interactive-program-must-be-events":!0,"patterns-in-switch-must-not-be-events":!0,"repeated-variable-in-tuple-assignment":!0,"constructor-used-as-procedure":!0,"undefined-procedure":!0,"procedure-arity-mismatch":!0,"structure-pattern-arity-mismatch":!0,"structure-construction-repeated-field":!0,"structure-construction-invalid-field":!0,"structure-construction-missing-field":!0,"structure-construction-cannot-be-an-event":!0,"undefined-function":!0,"function-arity-mismatch":!0,"type-used-as-constructor":!0,"procedure-used-as-constructor":!0,"undeclared-constructor":!0}}return a(t,[{key:"lint",value:function(t){return this._lintMain(t),this._symtable}},{key:"enableCheck",value:function(t,e){if(!(t in this._enabledLinterChecks))throw Error('Linter check "'+t+'" does not exist.');this._enabledLinterChecks[t]=e}},{key:"_lintCheck",value:function(t,e,r,n){this._enabledLinterChecks[r]&&o(t,e,r,n)}},{key:"_lintMain",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.definitions[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._addDefinitionToSymbolTable(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}t.definitions.length>0&&null===this._symtable.program&&this._lintCheck(t.startPos,t.endPos,"source-should-have-a-program-definition",[]);var s=!0,u=!1,c=void 0;try{for(var l,h=t.definitions[Symbol.iterator]();!(s=(l=h.next()).done);s=!0){var f=l.value;this._lintDefinition(f)}}catch(t){u=!0,c=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw c}}}},{key:"_addDefinitionToSymbolTable",value:function(t){switch(t.tag){case s.N_DefProgram:return this._symtable.defProgram(t);case s.N_DefInteractiveProgram:return this._symtable.defInteractiveProgram(t);case s.N_DefProcedure:return this._symtable.defProcedure(t);case s.N_DefFunction:return this._symtable.defFunction(t);case s.N_DefType:return this._symtable.defType(t);default:throw Error("Unknown definition: "+Symbol.keyFor(t.tag))}}},{key:"_lintDefinition",value:function(t){switch(t.tag){case s.N_DefProgram:return this._lintDefProgram(t);case s.N_DefInteractiveProgram:return this._lintDefInteractiveProgram(t);case s.N_DefProcedure:return this._lintDefProcedure(t);case s.N_DefFunction:return this._lintDefFunction(t);case s.N_DefType:return this._lintDefType(t);default:throw Error("Linter: Definition not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_lintDefProgram",value:function(t){this._lintStmtBlock(t.body,!0),this._symtable.exitScope()}},{key:"_lintDefInteractiveProgram",value:function(t){this._lintSwitchBranches(t.branches,!0)}},{key:"_lintDefProcedure",value:function(t){i(t.body)&&this._lintCheck(t.startPos,t.endPos,"procedure-should-not-have-return",[t.name.value]);var e=!0,r=!1,n=void 0;try{for(var o,a=t.parameters[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;this._symtable.addNewLocalName(s,u.LocalParameter)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}this._lintStmtBlock(t.body,!1),this._symtable.exitScope()}},{key:"_lintDefFunction",value:function(t){i(t.body)||this._lintCheck(t.startPos,t.endPos,"function-should-have-return",[t.name.value]);var e=!0,r=!1,n=void 0;try{for(var o,a=t.parameters[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;this._symtable.addNewLocalName(s,u.LocalParameter)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}this._lintStmtBlock(t.body,!0),this._symtable.exitScope()}},{key:"_lintDefType",value:function(t){}},{key:"_lintStatement",value:function(t){switch(t.tag){case s.N_StmtBlock:return this._lintStmtBlock(t,!1);case s.N_StmtReturn:return this._lintStmtReturn(t);case s.N_StmtIf:return this._lintStmtIf(t);case s.N_StmtRepeat:return this._lintStmtRepeat(t);case s.N_StmtForeach:return this._lintStmtForeach(t);case s.N_StmtWhile:return this._lintStmtWhile(t);case s.N_StmtSwitch:return this._lintStmtSwitch(t);case s.N_StmtAssignVariable:return this._lintStmtAssignVariable(t);case s.N_StmtAssignTuple:return this._lintStmtAssignTuple(t);case s.N_StmtProcedureCall:return this._lintStmtProcedureCall(t);default:throw Error("Linter: Statement not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_lintStmtBlock",value:function(t,e){var r=0,n=!0,i=!1,o=void 0;try{for(var a,u=t.statements[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var c=a.value;e&&r===t.statements.length-1||c.tag!==s.N_StmtReturn||this._lintCheck(c.startPos,c.endPos,"return-statement-not-allowed-here",[]),this._lintStatement(c),r++}}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}}},{key:"_lintStmtReturn",value:function(t){this._lintExpression(t.result)}},{key:"_lintStmtIf",value:function(t){this._lintExpression(t.condition),this._lintStatement(t.thenBlock),null!==t.elseBlock&&this._lintStatement(t.elseBlock)}},{key:"_lintStmtRepeat",value:function(t){this._lintExpression(t.times),this._lintStatement(t.body)}},{key:"_lintStmtForeach",value:function(t){this._lintExpression(t.range),this._symtable.addNewLocalName(t.index,u.LocalIndex),this._lintStatement(t.body),this._symtable.removeLocalName(t.index)}},{key:"_lintStmtWhile",value:function(t){this._lintExpression(t.condition),this._lintStatement(t.body)}},{key:"_lintStmtSwitch",value:function(t){this._lintExpression(t.subject),this._lintSwitchBranches(t.branches,!1)}},{key:"_lintSwitchBranches",value:function(t,e){var r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._lintPattern(s.pattern)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}this._switchBranchesCheckWildcard(t),this._switchBranchesCheckNoRepeats(t),this._switchBranchesCheckCompatible(t),e?this._switchBranchesCheckTypeEvent(t):this._switchBranchesCheckTypeNotEvent(t);var u=!0,c=!1,l=void 0;try{for(var h,f=t[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var p=h.value;this._lintSwitchBranchBody(p)}}catch(t){c=!0,l=t}finally{try{!u&&f.return&&f.return()}finally{if(c)throw l}}}},{key:"_switchBranchesCheckWildcard",value:function(t){var e=0,r=t.length,n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done);n=!0){var c=a.value;c.pattern.tag===s.N_PatternWildcard&&e!==r-1&&this._lintCheck(c.pattern.startPos,c.pattern.endPos,"wildcard-pattern-should-be-last",[]),e++}}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}}},{key:"_switchBranchesCheckNoRepeats",value:function(t){var e={},r={},n=!1,i=!0,o=!1,a=void 0;try{for(var u,c=t[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var l=u.value;switch(l.pattern.tag){case s.N_PatternStructure:var h=l.pattern.constructorName.value;h in e&&this._lintCheck(l.pattern.startPos,l.pattern.endPos,"structure-pattern-repeats-constructor",[h]),e[h]=!0;break;case s.N_PatternTuple:var f=l.pattern.parameters.length;f in r&&this._lintCheck(l.pattern.startPos,l.pattern.endPos,"structure-pattern-repeats-tuple-arity",[f]),r[f]=!0;break;case s.N_PatternTimeout:n&&this._lintCheck(l.pattern.startPos,l.pattern.endPos,"structure-pattern-repeats-timeout",[]),n=!0}}}catch(t){o=!0,a=t}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}}},{key:"_switchBranchesCheckCompatible",value:function(t){var e=null,r=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value,u=this._patternType(s.pattern);null===e?e=u:null!==u&&e!==u&&this._lintCheck(s.pattern.startPos,s.pattern.endPos,"pattern-does-not-match-type",[(0,l.i18n)("<pattern-type>")(e),(0,l.i18n)("<pattern-type>")(u)])}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"_switchBranchesCheckTypeEvent",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value,s=this._patternType(a.pattern);null!==s&&s!==(0,l.i18n)("TYPE:Event")&&this._lintCheck(a.pattern.startPos,a.pattern.endPos,"patterns-in-interactive-program-must-be-events",[])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_switchBranchesCheckTypeNotEvent",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._patternType(a.pattern)===(0,l.i18n)("TYPE:Event")&&this._lintCheck(a.pattern.startPos,a.pattern.endPos,"patterns-in-switch-must-not-be-events",[])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_lintSwitchBranchBody",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.pattern.parameters[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._symtable.addNewLocalName(a,u.LocalParameter)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._lintStatement(t.body);var s=!0,c=!1,l=void 0;try{for(var h,f=t.pattern.parameters[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var p=h.value;this._symtable.removeLocalName(p)}}catch(t){c=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(c)throw l}}}},{key:"_patternType",value:function(t){switch(t.tag){case s.N_PatternWildcard:return null;case s.N_PatternStructure:return this._symtable.constructorType(t.constructorName.value);case s.N_PatternTuple:return"_TUPLE_"+t.parameters.length.toString();case s.N_PatternTimeout:return(0,l.i18n)("TYPE:Event");default:throw Error('Linter: pattern "'+Symbol.keyFor(t.tag)+'" not implemented.')}}},{key:"_lintStmtAssignVariable",value:function(t){this._symtable.setLocalName(t.variable,u.LocalVariable),this._lintExpression(t.value)}},{key:"_lintStmtAssignTuple",value:function(t){var e={},r=!0,n=!1,i=void 0;try{for(var o,a=t.variables[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._symtable.setLocalName(s,u.LocalVariable),s.value in e&&this._lintCheck(s.startPos,s.endPos,"repeated-variable-in-tuple-assignment",[s.value]),e[s.value]=!0}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}this._lintExpression(t.value)}},{key:"_lintStmtProcedureCall",value:function(t){var e=t.procedureName.value;this._symtable.isProcedure(e)||(this._symtable.isConstructor(e)?this._lintCheck(t.startPos,t.endPos,"constructor-used-as-procedure",[e,this._symtable.constructorType(e)]):this._lintCheck(t.startPos,t.endPos,"undefined-procedure",[e]));var r=this._symtable.procedureParameters(e).length,n=t.args.length;r!==n&&this._lintCheck(t.startPos,t.endPos,"procedure-arity-mismatch",[e,r,n]);var i=!0,o=!1,a=void 0;try{for(var s,u=t.args[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;this._lintExpression(c)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_lintPattern",value:function(t){switch(t.tag){case s.N_PatternWildcard:return this._lintPatternWildcard(t);case s.N_PatternStructure:return this._lintPatternStructure(t);case s.N_PatternTuple:return this._lintPatternTuple(t);case s.N_PatternTimeout:return this._lintPatternTimeout(t);default:throw Error('Linter: pattern "'+Symbol.keyFor(t.tag)+'" not implemented.')}}},{key:"_lintPatternWildcard",value:function(t){}},{key:"_lintPatternStructure",value:function(t){var e=t.constructorName.value;if(!this._symtable.isConstructor(e))return void this._failExpectedConstructorButGot(t.startPos,t.endPos,e);var r=this._symtable.constructorFields(e).length,n=t.parameters.length;n>0&&r!==n&&this._lintCheck(t.startPos,t.endPos,"structure-pattern-arity-mismatch",[e,r,n])}},{key:"_lintPatternTuple",value:function(t){}},{key:"_lintPatternTimeout",value:function(t){}},{key:"_lintExpression",value:function(t){switch(t.tag){case s.N_ExprVariable:return this._lintExprVariable(t);case s.N_ExprConstantNumber:return this._lintExprConstantNumber(t);case s.N_ExprConstantString:return this._lintExprConstantString(t);case s.N_ExprList:return this._lintExprList(t);case s.N_ExprRange:return this._lintExprRange(t);case s.N_ExprTuple:return this._lintExprTuple(t);case s.N_ExprStructure:return this._lintExprStructure(t);case s.N_ExprStructureUpdate:return this._lintExprStructureUpdate(t);case s.N_ExprFunctionCall:return this._lintExprFunctionCall(t);default:throw Error("Linter: Expression not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_lintExprVariable",value:function(t){}},{key:"_lintExprConstantNumber",value:function(t){}},{key:"_lintExprConstantString",value:function(t){}},{key:"_lintExprList",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._lintExpression(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_lintExprRange",value:function(t){this._lintExpression(t.first),null!==t.second&&this._lintExpression(t.second),this._lintExpression(t.last)}},{key:"_lintExprTuple",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._lintExpression(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_lintExprStructure",value:function(t){this._lintExprStructureOrUpdate(t,null)}},{key:"_lintExprStructureUpdate",value:function(t){this._lintExprStructureOrUpdate(t,t.original)}},{key:"_lintExprStructureOrUpdate",value:function(t,e){var r=t.constructorName.value;if(!this._symtable.isConstructor(r))return void this._failExpectedConstructorButGot(t.startPos,t.endPos,r);this._checkStructureTypeNotEvent(r,t),this._checkStructureNoRepeatedFields(r,t),this._checkStructureBindingsCorrect(r,t),null===e&&this._checkStructureBindingsComplete(r,t),null!==e&&this._lintExpression(e);var n=!0,i=!1,o=void 0;try{for(var a,s=t.fieldBindings[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this._lintExpression(u.value)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"_checkStructureNoRepeatedFields",value:function(t,e){var r=e.fieldNames(),n={},i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;c in n&&this._lintCheck(e.startPos,e.endPos,"structure-construction-repeated-field",[t,c]),n[c]=!0}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_checkStructureBindingsCorrect",value:function(t,e){var r=e.fieldNames(),n=this._symtable.constructorFields(t),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;-1===n.indexOf(c)&&this._lintCheck(e.startPos,e.endPos,"structure-construction-invalid-field",[t,c])}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_checkStructureBindingsComplete",value:function(t,e){var r=e.fieldNames(),n=this._symtable.constructorFields(t),i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;-1===r.indexOf(c)&&this._lintCheck(e.startPos,e.endPos,"structure-construction-missing-field",[t,c])}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_checkStructureTypeNotEvent",value:function(t,e){this._symtable.constructorType(t)===(0,l.i18n)("TYPE:Event")&&this._lintCheck(e.startPos,e.endPos,"structure-construction-cannot-be-an-event",[t])}},{key:"_lintExprFunctionCall",value:function(t){var e=t.functionName.value;this._symtable.isFunction(e)||this._symtable.isField(e)||this._lintCheck(t.startPos,t.endPos,"undefined-function",[e]);var r=void 0;r=this._symtable.isFunction(e)?this._symtable.functionParameters(e).length:1;var n=t.args.length;r!==n&&this._lintCheck(t.startPos,t.endPos,"function-arity-mismatch",[e,r,n]);var i=!0,o=!1,a=void 0;try{for(var s,u=t.args[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;this._lintExpression(c)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"_failExpectedConstructorButGot",value:function(t,e,r){this._symtable.isType(r)?this._lintCheck(t,e,"type-used-as-constructor",[r,this._symtable.typeConstructors(r)]):this._symtable.isProcedure(r)?this._lintCheck(t,e,"procedure-used-as-constructor",[r]):this._lintCheck(t,e,"undeclared-constructor",[r])}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Compiler=void 0;var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=r(2),a=r(8),s=r(4),u=r(3),c=r(0);e.Compiler=function(){function t(e){n(this,t),this._symtable=e,this._code=new a.Code([]),this._nextLabel=0,this._nextVariable=0,this._primitives=new u.RuntimePrimitives}return i(t,[{key:"compile",value:function(t){return this._compileMain(t),this._code}},{key:"_compileMain",value:function(t){if(0===t.definitions.length)return void this._produce(t.startPos,t.endPos,new a.IReturn);var e=!0,r=!1,n=void 0;try{for(var i,s=t.definitions[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var u=i.value;u.tag===o.N_DefProgram?this._compileDefProgram(u):u.tag===o.N_DefInteractiveProgram&&this._compileDefInteractiveProgram(u)}}catch(t){r=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw n}}var c=!0,l=!1,h=void 0;try{for(var f,p=t.definitions[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var _=f.value;_.tag===o.N_DefProcedure?this._compileDefProcedure(_):_.tag===o.N_DefFunction&&this._compileDefFunction(_)}}catch(t){l=!0,h=t}finally{try{!c&&p.return&&p.return()}finally{if(l)throw h}}}},{key:"_compileDefProgram",value:function(t){this._compileStatement(t.body),this._produce(t.startPos,t.endPos,new a.IReturn)}},{key:"_compileDefInteractiveProgram",value:function(t){this._compileMatchSwitchBranches(t),this._produce(t.startPos,t.endPos,new a.IReturn)}},{key:"_compileDefProcedure",value:function(t){this._produce(t.startPos,t.endPos,new a.ILabel(t.name.value));for(var e=0;e<t.parameters.length;e++){var r=t.parameters[e].value;this._produce(t.startPos,t.endPos,new a.ISetVariable(r))}this._compileStatement(t.body),this._produce(t.startPos,t.endPos,new a.IReturn)}},{key:"_compileDefFunction",value:function(t){this._produceList(t.startPos,t.endPos,[new a.ILabel(t.name.value),new a.ISaveState]);for(var e=0;e<t.parameters.length;e++){var r=t.parameters[e].value;this._produce(t.startPos,t.endPos,new a.ISetVariable(r))}this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IRestoreState,new a.IReturn])}},{key:"_compileStatement",value:function(t){switch(t.tag){case o.N_StmtBlock:return this._compileStmtBlock(t);case o.N_StmtReturn:return this._compileStmtReturn(t);case o.N_StmtIf:return this._compileStmtIf(t);case o.N_StmtRepeat:return this._compileStmtRepeat(t);case o.N_StmtForeach:return this._compileStmtForeach(t);case o.N_StmtWhile:return this._compileStmtWhile(t);case o.N_StmtSwitch:return this._compileStmtSwitch(t);case o.N_StmtAssignVariable:return this._compileStmtAssignVariable(t);case o.N_StmtAssignTuple:return this._compileStmtAssignTuple(t);case o.N_StmtProcedureCall:return this._compileStmtProcedureCall(t);default:throw Error("Compiler: Statement not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compileStmtBlock",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.statements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var a=i.value;this._compileStatement(a)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_compileStmtReturn",value:function(t){return this._compileExpression(t.result)}},{key:"_compileStmtIf",value:function(t){this._compileExpression(t.condition),this._produce(t.condition.startPos,t.condition.endPos,new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})));var e=this._freshLabel();if(this._produce(t.startPos,t.endPos,new a.IJumpIfFalse(e)),this._compileStatement(t.thenBlock),null===t.elseBlock)this._produce(t.startPos,t.endPos,new a.ILabel(e));else{var r=this._freshLabel();this._produceList(t.startPos,t.endPos,[new a.IJump(r),new a.ILabel(e)]),this._compileStatement(t.elseBlock),this._produce(t.startPos,t.endPos,new a.ILabel(r))}}},{key:"_compileStmtRepeat",value:function(t){this._compileExpression(t.times),this._produce(t.times.startPos,t.times.endPos,new a.ITypeCheck(new s.TypeInteger));var e=this._freshLabel(),r=this._freshLabel();this._produceList(t.startPos,t.endPos,[new a.ILabel(e),new a.IDup,new a.IPushInteger(0),new a.IPrimitiveCall(">",2),new a.IJumpIfFalse(r)]),this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IPushInteger(1),new a.IPrimitiveCall("-",2),new a.IJump(e),new a.ILabel(r),new a.IPop])}},{key:"_compileStmtForeach",value:function(t){var e=this._freshLabel(),r=this._freshLabel(),n=this._freshVariable(),i=this._freshVariable(),o=this._freshVariable();this._compileExpression(t.range),this._produceList(t.range.startPos,t.range.endPos,[new a.ITypeCheck(new s.TypeList(new s.TypeAny)),new a.ISetVariable(n),new a.IPushVariable(n),new a.IPrimitiveCall("_unsafeListLength",1),new a.ISetVariable(o)]),this._produceList(t.startPos,t.endPos,[new a.IPushInteger(0),new a.ISetVariable(i),new a.ILabel(e),new a.IPushVariable(i),new a.IPushVariable(o),new a.IPrimitiveCall("<",2),new a.IJumpIfFalse(r),new a.IPushVariable(n),new a.IPushVariable(i),new a.IPrimitiveCall("_unsafeListNth",2),new a.ISetVariable(t.index.value)]),this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IPushVariable(i),new a.IPushInteger(1),new a.IPrimitiveCall("+",2),new a.ISetVariable(i),new a.IJump(e),new a.ILabel(r),new a.IUnsetVariable(n),new a.IUnsetVariable(o),new a.IUnsetVariable(i),new a.IUnsetVariable(t.index.value)])}},{key:"_compileStmtWhile",value:function(t){var e=this._freshLabel(),r=this._freshLabel();this._produce(t.startPos,t.endPos,new a.ILabel(e)),this._compileExpression(t.condition),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.IJumpIfFalse(r)]),this._compileStatement(t.body),this._produceList(t.startPos,t.endPos,[new a.IJump(e),new a.ILabel(r)])}},{key:"_compileStmtSwitch",value:function(t){this._compileExpression(t.subject),this._compileMatchSwitchBranches(t)}},{key:"_compileMatchSwitchBranches",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t.branches[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,c=this._freshLabel();e.push(c),this._compilePatternCheck(u.pattern,c)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}this._produceList(t.startPos,t.endPos,[new a.IPushString("switch-does-not-match"),new a.IPrimitiveCall("_FAIL",1)]);for(var l=this._freshLabel(),h=0;h<e.length;h++){var f=t.branches[h],p=e[h];this._produce(f.startPos,f.endPos,new a.ILabel(p)),this._compilePatternBind(f.pattern),this._produce(f.startPos,f.endPos,new a.IPop),this._compileStatement(f.body),this._compilePatternUnbind(f.pattern),this._produce(f.startPos,f.endPos,new a.IJump(l))}this._produce(t.startPos,t.endPos,new a.ILabel(l))}},{key:"_compileStmtAssignVariable",value:function(t){this._compileExpression(t.value),this._produce(t.startPos,t.endPos,new a.ISetVariable(t.variable.value))}},{key:"_compileStmtAssignTuple",value:function(t){this._compileExpression(t.value);for(var e=[],r=0;r<t.variables.length;r++)e.push(new s.TypeAny);var n=new s.TypeTuple(e);this._produce(t.startPos,t.endPos,new a.ITypeCheck(n));for(var i=0;i<t.variables.length;i++)this._produceList(t.startPos,t.endPos,[new a.IReadTupleComponent(i),new a.ISetVariable(t.variables[i].value)]);this._produce(t.startPos,t.endPos,new a.IPop)}},{key:"_compileStmtProcedureCall",value:function(t){var e=t.procedureName.value,r=!0,n=!1,i=void 0;try{for(var o,a=t.args[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._compileExpression(s)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(this._primitives.isProcedure(e))this._compileStmtProcedureCallPrimitive(t);else{if(!this._symtable.isProcedure(e))throw Error("Compiler: "+e+" is an undefined procedure.");this._compileStmtProcedureCallUserDefined(t)}}},{key:"_compileStmtProcedureCallPrimitive",value:function(t){this._produce(t.startPos,t.endPos,new a.IPrimitiveCall(t.procedureName.value,t.args.length))}},{key:"_compileStmtProcedureCallUserDefined",value:function(t){this._produce(t.startPos,t.endPos,new a.ICall(t.procedureName.value,t.args.length))}},{key:"_compilePatternCheck",value:function(t,e){switch(t.tag){case o.N_PatternWildcard:return this._compilePatternCheckWildcard(t,e);case o.N_PatternStructure:return this._compilePatternCheckStructure(t,e);case o.N_PatternTuple:return this._compilePatternCheckTuple(t,e);case o.N_PatternTimeout:return this._compilePatternCheckTimeout(t,e);default:throw Error("Compiler: Pattern check not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compilePatternCheckWildcard",value:function(t,e){this._produce(t.startPos,t.endPos,new a.IJump(e))}},{key:"_compilePatternCheckStructure",value:function(t,e){var r=t.constructorName.value,n=this._symtable.constructorType(r),i=new s.TypeStructure(n,{});this._produce(t.startPos,t.endPos,new a.ITypeCheck(i)),this._produce(t.startPos,t.endPos,new a.IJumpIfStructure(r,e))}},{key:"_compilePatternCheckTuple",value:function(t,e){for(var r=[],n=0;n<t.parameters.length;n++)r.push(new s.TypeAny);var i=new s.TypeTuple(r);this._produce(t.startPos,t.endPos,new a.ITypeCheck(i)),this._produce(t.startPos,t.endPos,new a.IJumpIfTuple(t.parameters.length,e))}},{key:"_compilePatternCheckTimeout",value:function(t,e){this._produce(t.startPos,t.endPos,new a.IJumpIfStructure((0,c.i18n)("CONS:TIMEOUT"),e))}},{key:"_compilePatternBind",value:function(t){switch(t.tag){case o.N_PatternWildcard:return;case o.N_PatternStructure:return void this._compilePatternBindStructure(t);case o.N_PatternTuple:return void this._compilePatternBindTuple(t);case o.N_PatternTimeout:return;default:throw Error("Compiler: Pattern binding not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compilePatternBindStructure",value:function(t){if(0!==t.parameters.length)for(var e=t.constructorName.value,r=this._symtable.constructorFields(e),n=0;n<r.length;n++){var i=t.parameters[n],o=r[n];this._produceList(t.startPos,t.endPos,[new a.IReadStructureField(o),new a.ISetVariable(i.value)])}}},{key:"_compilePatternBindTuple",value:function(t){for(var e=0;e<t.parameters.length;e++){var r=t.parameters[e];this._produceList(t.startPos,t.endPos,[new a.IReadTupleComponent(e),new a.ISetVariable(r.value)])}}},{key:"_compilePatternUnbind",value:function(t){switch(t.tag){case o.N_PatternWildcard:return;case o.N_PatternStructure:return void this._compilePatternUnbindStructure(t);case o.N_PatternTuple:return void this._compilePatternUnbindTuple(t);case o.N_PatternTimeout:return;default:throw Error("Compiler: Pattern unbinding not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compilePatternUnbindStructure",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.parameters[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._produceList(t.startPos,t.endPos,[new a.IUnsetVariable(s.value)])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_compilePatternUnbindTuple",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.parameters[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._produceList(t.startPos,t.endPos,[new a.IUnsetVariable(s.value)])}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}}},{key:"_compileExpression",value:function(t){switch(t.tag){case o.N_ExprVariable:return this._compileExprVariable(t);case o.N_ExprConstantNumber:return this._compileExprConstantNumber(t);case o.N_ExprConstantString:return this._compileExprConstantString(t);case o.N_ExprList:return this._compileExprList(t);case o.N_ExprRange:return this._compileExprRange(t);case o.N_ExprTuple:return this._compileExprTuple(t);case o.N_ExprStructure:return this._compileExprStructure(t);case o.N_ExprStructureUpdate:return this._compileExprStructureUpdate(t);case o.N_ExprFunctionCall:return this._compileExprFunctionCall(t);default:throw Error("Compiler: Expression not implemented: "+Symbol.keyFor(t.tag))}}},{key:"_compileExprVariable",value:function(t){this._produce(t.startPos,t.endPos,new a.IPushVariable(t.variableName.value))}},{key:"_compileExprConstantNumber",value:function(t){this._produce(t.startPos,t.endPos,new a.IPushInteger(t.number.value))}},{key:"_compileExprConstantString",value:function(t){this._produce(t.startPos,t.endPos,new a.IPushString(t.string.value))}},{key:"_compileExprList",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._compileExpression(s)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._produce(t.startPos,t.endPos,new a.IMakeList(t.elements.length))}},{key:"_compileExprRange",value:function(t){this._compileExpression(t.first),this._compileExpression(t.last),null===t.second?this._produce(t.startPos,t.endPos,new a.IPrimitiveCall("_makeRange",2)):(this._compileExpression(t.second),this._produce(t.startPos,t.endPos,new a.IPrimitiveCall("_makeRangeWithSecond",3)))}},{key:"_compileExprTuple",value:function(t){var e=!0,r=!1,n=void 0;try{for(var i,o=t.elements[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var s=i.value;this._compileExpression(s)}}catch(t){r=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw n}}this._produce(t.startPos,t.endPos,new a.IMakeTuple(t.elements.length))}},{key:"_compileExprStructure",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t.fieldBindings[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this._compileExpression(u.value),e.push(u.fieldName.value)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var c=t.constructorName.value,l=this._symtable.constructorType(c);this._produce(t.startPos,t.endPos,new a.IMakeStructure(l,c,e))}},{key:"_compileExprStructureUpdate",value:function(t){this._compileExpression(t.original);var e=[],r=!0,n=!1,i=void 0;try{for(var o,s=t.fieldBindings[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this._compileExpression(u.value),e.push(u.fieldName.value)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var c=t.constructorName.value,l=this._symtable.constructorType(c);this._produce(t.startPos,t.endPos,new a.IUpdateStructure(l,c,e))}},{key:"_compileExprFunctionCall",value:function(t){var e=t.functionName.value;if("&&"===e)this._compileExprFunctionCallAnd(t);else if("||"===e)this._compileExprFunctionCallOr(t);else{var r=!0,n=!1,i=void 0;try{for(var o,a=t.args[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;this._compileExpression(s)}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}if(this._primitives.isFunction(e))this._compileExprFunctionCallPrimitive(t);else if(this._symtable.isFunction(e))this._compileExprFunctionCallUserDefined(t);else{if(!this._symtable.isField(e))throw Error("Compiler: "+e+" is an undefined function.");this._compileExprFunctionCallFieldAccessor(t)}}}},{key:"_compileExprFunctionCallAnd",value:function(t){var e=t.args[0],r=t.args[1],n=this._freshLabel();this._compileExpression(e),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.IJumpIfStructure((0,c.i18n)("CONS:False"),n),new a.IPop]),this._compileExpression(r),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.ILabel(n)])}},{key:"_compileExprFunctionCallOr",value:function(t){var e=t.args[0],r=t.args[1],n=this._freshLabel();this._compileExpression(e),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.IJumpIfStructure((0,c.i18n)("CONS:True"),n),new a.IPop]),this._compileExpression(r),this._produceList(t.startPos,t.endPos,[new a.ITypeCheck(new s.TypeStructure((0,c.i18n)("TYPE:Bool"),{})),new a.ILabel(n)])}},{key:"_compileExprFunctionCallPrimitive",value:function(t){this._produce(t.startPos,t.endPos,new a.IPrimitiveCall(t.functionName.value,t.args.length))}},{key:"_compileExprFunctionCallUserDefined",value:function(t){this._produce(t.startPos,t.endPos,new a.ICall(t.functionName.value,t.args.length))}},{key:"_compileExprFunctionCallFieldAccessor",value:function(t){this._produceList(t.startPos,t.endPos,[new a.IReadStructureFieldPop(t.functionName.value)])}},{key:"_produce",value:function(t,e,r){r.startPos=t,r.endPos=e,this._code.produce(r)}},{key:"_produceList",value:function(t,e,r){var n=!0,i=!1,o=void 0;try{for(var a,s=r[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=a.value;this._produce(t,e,u)}}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"_freshLabel",value:function(){var t="_l"+this._nextLabel.toString();return this._nextLabel++,t}},{key:"_freshVariable",value:function(){var t="_v"+this._nextVariable.toString();return this._nextVariable++,t}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e,r,n){throw new l.GbsRuntimeError(t,e,r,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.VirtualMachine=void 0;var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),u=r(8),c=r(4),l=r(1),h=r(0),f=r(3),p=Symbol.for("RT_ExitProgram"),_=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,Symbol.keyFor(t)));return r.tag=t,r}return o(e,t),e}(Error),m=function(t){function e(t){n(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p));return r.returnValue=t,r}return o(e,t),e}(_),d=function(){function t(e,r){n(this,t),this._routineName=e,this._instructionPointer=r,this._variables={},this._stack=[]}return s(t,[{key:"setVariable",value:function(t,e){this._variables[t]=e}},{key:"unsetVariable",value:function(t,e){delete this._variables[t]}},{key:"getVariable",value:function(t){return t in this._variables?this._variables[t]:null}},{key:"stackEmpty",value:function(){return 0===this._stack.length}},{key:"pushValue",value:function(t){this._stack.push(t)}},{key:"stackTop",value:function(){if(0===this._stack.length)throw Error("VM: no value at the top of the stack; the stack is empty.");return this._stack[this._stack.length-1]}},{key:"popValue",value:function(){if(0===this._stack.length)throw Error("VM: no value to pop; the stack is empty.");return this._stack.pop()}},{key:"routineName",get:function(){return this._routineName}},{key:"instructionPointer",get:function(){return this._instructionPointer},set:function(t){this._instructionPointer=t}}]),t}();e.VirtualMachine=function(){function t(e,r){n(this,t),this._code=e,this._labelTargets=this._code.labelTargets(),this._callStack=[],this._callStack.push(new d("program",0)),this._globalStateStack=[r],this._primitives=new f.RuntimePrimitives,this._snapshotCallback=null}return s(t,[{key:"run",value:function(){return this.runWithTimeout(0)}},{key:"runWithTimeout",value:function(t){return this.runWithTimeoutTakingSnapshots(t,null)}},{key:"runEventWithTimeout",value:function(t,e){return this._callStack=[new d("program",0)],this._currentFrame().pushValue(t),this.runWithTimeout(e)}},{key:"runWithTimeoutTakingSnapshots",value:function(t,e){var r=(new Date).getTime();this._snapshotCallback=e,this._takeSnapshot("program");try{for(;;)this._step(),this._timeoutIfNeeded(r,t)}catch(t){if(t.tag===p)return t.returnValue;throw t}}},{key:"_timeoutIfNeeded",value:function(t,e){if(e>0&&(new Date).getTime()-t>e){var r=this._currentInstruction();a(r.startPos,r.endPos,"timeout",[e])}}},{key:"_takeSnapshot",value:function(t){if(null!==this._snapshotCallback){var e=this._currentInstruction();this._snapshotCallback(t,e.startPos,this._callStack,this.globalState())}}},{key:"globalState",value:function(){return this._globalStateStack[this._globalStateStack.length-1]}},{key:"setGlobalState",value:function(t){this._globalStateStack[this._globalStateStack.length-1]=t}},{key:"_currentFrame",value:function(){return this._callStack[this._callStack.length-1]}},{key:"_currentInstruction",value:function(){return this._code.at(this._currentFrame().instructionPointer)}},{key:"_step",value:function(){switch(this._currentInstruction().opcode){case u.I_PushInteger:return this._stepPushInteger();case u.I_PushString:return this._stepPushString();case u.I_PushVariable:return this._stepPushVariable();case u.I_SetVariable:return this._stepSetVariable();case u.I_UnsetVariable:return this._stepUnsetVariable();case u.I_Label:return this._stepLabel();case u.I_Jump:return this._stepJump();case u.I_JumpIfFalse:return this._stepJumpIfFalse();case u.I_JumpIfStructure:return this._stepJumpIfStructure();case u.I_JumpIfTuple:return this._stepJumpIfTuple();case u.I_Call:return this._stepCall();case u.I_Return:return this._stepReturn();case u.I_MakeTuple:return this._stepMakeTuple();case u.I_MakeList:return this._stepMakeList();case u.I_MakeStructure:return this._stepMakeStructure();case u.I_UpdateStructure:return this._stepUpdateStructure();case u.I_ReadTupleComponent:return this._stepReadTupleComponent();case u.I_ReadStructureField:return this._stepReadStructureField();case u.I_ReadStructureFieldPop:return this._stepReadStructureFieldPop();case u.I_Add:return this._stepAdd();case u.I_Dup:return this._stepDup();case u.I_Pop:return this._stepPop();case u.I_PrimitiveCall:return this._stepPrimitiveCall();case u.I_SaveState:return this._stepSaveState();case u.I_RestoreState:return this._stepRestoreState();case u.I_TypeCheck:return this._stepTypeCheck();default:throw Error("VM: opcode "+Symbol.keyFor(this._currentInstruction().opcode)+" not implemented")}}},{key:"_stepPushInteger",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.pushValue(new c.ValueInteger(e.number)),t.instructionPointer++}},{key:"_stepPushString",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.pushValue(new c.ValueString(e.string)),t.instructionPointer++}},{key:"_stepPushVariable",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.getVariable(e.variableName);null===r&&a(e.startPos,e.endPos,"undefined-variable",[e.variableName]),t.pushValue(r),t.instructionPointer++}},{key:"_stepSetVariable",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.popValue(),n=t.getVariable(e.variableName);if(null!==n){var i=n.type(),o=r.type();null===(0,c.joinTypes)(i,o)&&a(e.startPos,e.endPos,"incompatible-types-on-assignment",[e.variableName,i.toString(),o.toString()])}t.setVariable(e.variableName,r),t.instructionPointer++}},{key:"_stepUnsetVariable",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.unsetVariable(e.variableName),t.instructionPointer++}},{key:"_stepLabel",value:function(){this._currentFrame().instructionPointer++}},{key:"_stepJump",value:function(){var t=this._currentFrame(),e=this._currentInstruction();t.instructionPointer=this._labelTargets[e.targetLabel]}},{key:"_stepJumpIfFalse",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.popValue();r.tag===c.V_Structure&&"False"===r.constructorName?t.instructionPointer=this._labelTargets[e.targetLabel]:t.instructionPointer++}},{key:"_stepJumpIfStructure",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.stackTop();r.tag===c.V_Structure&&r.constructorName===e.constructorName?t.instructionPointer=this._labelTargets[e.targetLabel]:t.instructionPointer++}},{key:"_stepJumpIfTuple",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.stackTop();r.tag===c.V_Tuple&&r.size()===e.size?t.instructionPointer=this._labelTargets[e.targetLabel]:t.instructionPointer++}},{key:"_stepCall",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=new d(e.targetLabel,this._labelTargets[e.targetLabel]);this._callStack.push(r);for(var n=0;n<e.nargs;n++)t.stackEmpty()&&a(e.startPos,e.endPos,"too-few-arguments",[e.targetLabel]),r.pushValue(t.popValue())}},{key:"_stepReturn",value:function(){var t=this._currentFrame();this._takeSnapshot(t.routineName);var e=void 0;if(t.stackEmpty())e=null;else if(e=t.popValue(),!t.stackEmpty())throw Error("VM: stack should be empty");if(this._callStack.pop(),0===this._callStack.length)throw new m(e);var r=this._currentFrame();null!==e&&r.pushValue(e),r.instructionPointer++}},{key:"_stepMakeTuple",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r=[],n=0;n<e.size;n++)r.unshift(t.popValue());t.pushValue(new c.ValueTuple(r)),t.instructionPointer++}},{key:"_stepMakeList",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r=[],n=0;n<e.size;n++)r.unshift(t.popValue());var i=new c.TypeAny,o=0,s=!0,u=!1,l=void 0;try{for(var h,f=r[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var p=h.value,_=i,m=p.type();i=(0,c.joinTypes)(_,m),null===i&&a(e.startPos,e.endPos,"incompatible-types-on-list-creation",[o,_.toString(),m.toString()]),o++}}catch(t){u=!0,l=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw l}}t.pushValue(new c.ValueList(r)),t.instructionPointer++}},{key:"_stepMakeStructure",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r={},n=e.fieldNames.length,i=0;i<n;i++){r[e.fieldNames[n-i-1]]=t.popValue()}t.pushValue(new c.ValueStructure(e.typeName,e.constructorName,r)),t.instructionPointer++}},{key:"_stepUpdateStructure",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r={},n=[],i=e.fieldNames.length,o=0;o<i;o++){var s=e.fieldNames[i-o-1];r[s]=t.popValue(),n.unshift(s)}var u=t.popValue();if(u.tag!==c.V_Structure&&a(e.startPos,e.endPos,"expected-structure-but-got",[e.constructorName,(0,h.i18n)(Symbol.keyFor(u.tag))]),u.constructorName!==e.constructorName&&a(e.startPos,e.endPos,"expected-constructor-but-got",[e.constructorName,u.constructorName]),u.typeName!==e.typeName)throw Error("VM: UpdateStructure instruction does not match type.");var l=!0,f=!1,p=void 0;try{for(var _,m=n[Symbol.iterator]();!(l=(_=m.next()).done);l=!0){var d=_.value,y=u.fields[d].type(),v=r[d].type();null===(0,c.joinTypes)(y,v)&&a(e.startPos,e.endPos,"incompatible-types-on-structure-update",[d,y.toString(),v.toString()])}}catch(t){f=!0,p=t}finally{try{!l&&m.return&&m.return()}finally{if(f)throw p}}t.pushValue(u.updateFields(r)),t.instructionPointer++}},{key:"_stepReadTupleComponent",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=t.stackTop();r.tag!==c.V_Tuple&&a(e.startPos,e.endPos,"expected-tuple-value-but-got",[r.type().toString()]),e.index>=r.size()&&a(e.startPos,e.endPos,"tuple-component-out-of-bounds",[r.size(),e.index]),t.pushValue(r.components[e.index]),t.instructionPointer++}},{key:"_stepReadStructureFieldGeneric",value:function(t){var e=this._currentFrame(),r=this._currentInstruction(),n=void 0;n=t?e.popValue():e.stackTop(),n.tag!==c.V_Structure&&a(r.startPos,r.endPos,"expected-structure-value-but-got",[n.type().toString()]),r.fieldName in n.fields||a(r.startPos,r.endPos,"structure-field-not-present",[n.fieldNames(),r.fieldName]),e.pushValue(n.fields[r.fieldName]),e.instructionPointer++}},{key:"_stepReadStructureField",value:function(){this._stepReadStructureFieldGeneric(!1)}},{key:"_stepReadStructureFieldPop",value:function(){this._stepReadStructureFieldGeneric(!0)}},{key:"_stepAdd",value:function(){var t=this._currentFrame(),e=t.popValue(),r=t.popValue();t.pushValue(e.add(r)),t.instructionPointer++}},{key:"_stepDup",value:function(){var t=this._currentFrame(),e=t.popValue();t.pushValue(e),t.pushValue(e),t.instructionPointer++}},{key:"_stepPop",value:function(){var t=this._currentFrame();t.popValue(),t.instructionPointer++}},{key:"_stepPrimitiveCall",value:function(){for(var t=this._currentFrame(),e=this._currentInstruction(),r=[],n=0;n<e.nargs;n++)r.unshift(t.popValue());this._primitives.isOperation(e.primitiveName)||a(e.startPos,e.endPos,"primitive-does-not-exist",[e.primitiveName]);var i=this._primitives.getOperation(e.primitiveName);i.argumentTypes.length!==e.nargs&&a(e.startPos,e.endPos,"primitive-arity-mismatch",[e.primitiveName,i.argumentTypes.length,e.nargs]);for(var o=0;o<e.nargs;o++){var s=i.argumentTypes[o],u=r[o].type();null===(0,c.joinTypes)(s,u)&&a(e.startPos,e.endPos,"primitive-argument-type-mismatch",[e.primitiveName,o+1,s.toString(),u.toString()])}i.validateArguments(e.startPos,e.endPos,this.globalState(),r);var l=i.call(this.globalState(),r);null!==l&&t.pushValue(l),this._takeSnapshot(e.primitiveName),t.instructionPointer++}},{key:"_stepSaveState",value:function(){var t=this._currentFrame();this._globalStateStack.push(this.globalState().clone()),t.instructionPointer++}},{key:"_stepRestoreState",value:function(){var t=this._currentFrame();if(this._globalStateStack.pop(),0===this._globalStateStack.length)throw Error("RestoreState: the stack of global states is empty.");t.instructionPointer++}},{key:"_stepTypeCheck",value:function(){var t=this._currentFrame(),e=this._currentInstruction(),r=e.type,n=t.stackTop().type();null===(0,c.joinTypes)(r,n)&&a(e.startPos,e.endPos,"expected-value-of-type-but-got",[r.toString(),n.toString()]),t.instructionPointer++}}]),t}()},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){var e={};e.head={x:t.head[0],y:t.head[1]},e.width=t.width,e.height=t.height,e.table=[];for(var r=0;r<t.height;r++){for(var n=[],i=0;i<t.width;i++){var o=t.board[i][r],a={};o.a>0&&(a.blue=o.a),o.n>0&&(a.black=o.n),o.r>0&&(a.red=o.r),o.v>0&&(a.green=o.v),n.push(a)}e.table.unshift(n)}return e}function o(t){var e={};e.head=[t.head.x,t.head.y],e.width=t.width,e.height=t.height,e.board=[];for(var r=0;r<e.width;r++){for(var n=[],i=0;i<e.height;i++){var o=t.table[e.height-i-1][r],a="blue"in o?o.blue:0,s="black"in o?o.black:0,u="red"in o?o.red:0,c="green"in o?o.green:0;n.push({a:a,n:s,r:u,v:c})}e.board.push(n)}return e}function a(t){var e={};e.x=t.head[0],e.y=t.head[1],e.sizeX=t.width,e.sizeY=t.height,e.table=[];for(var r=0;r<t.height;r++){for(var n=[],i=0;i<t.width;i++){var o=t.board[i][r];n.push({blue:o.a,black:o.n,red:o.r,green:o.v})}e.table.unshift(n)}return JSON.stringify(e)}function s(t){var e=JSON.parse(t),r={};r.head=[e.x,e.y],r.width=e.sizeX,r.height=e.sizeY,r.board=[];for(var n=0;n<r.width;n++){for(var i=[],o=0;o<r.height;o++){var a=e.table[r.height-o-1][n];i.push({a:a.blue,n:a.black,r:a.red,v:a.green})}r.board.push(i)}return r}function u(t){var e=[];e.push("GBB/1.0"),e.push("size "+t.width.toString()+" "+t.height.toString());for(var r=0;r<t.height;r++)for(var n=0;n<t.width;n++){var i=t.board[n][r];if(i.a+i.n+i.r+i.v!==0){var o="cell "+n.toString()+" "+r.toString();i.a>0&&(o+=" Azul "+i.a.toString()),i.n>0&&(o+=" Negro "+i.n.toString()),i.r>0&&(o+=" Rojo "+i.r.toString()),i.v>0&&(o+=" Verde "+i.v.toString()),e.push(o)}}return e.push("head "+t.head[0].toString()+" "+t.head[1].toString()),e.join("\n")+"\n"}function c(t){function e(t){return" "===t||"\t"===t||"\r"===t||"\n"===t}function r(t){for(var e=0;e<t.length;e++)if(-1==="0123456789".indexOf(t[e]))return!1;return t.length>0}function n(){s<t.length&&e(t[s])&&s++}function i(){var r=[];for(n();s<t.length&&!e(t[s]);)r.push(t[s]),s++;return r.join("")}function o(t){var e=i();if(!r(e))throw Error(t);if((e=parseInt(e,10))<0)throw Error(t);return e}function a(t,e,r){var n=o(r);if(n<t||n>=e)throw Error(r);return n}var s=0,u={};if("GBB/1.0"!==i())throw Error("GBB/1.0: Board not in GBB/1.0 format.");if("size"!==i())throw Error("GBB/1.0: Board lacks a size declaration.");if(u.width=o("GBB/1.0: Board width is not a number."),u.height=o("GBB/1.0: Board height is not a number."),u.width<=0||u.height<=0)throw Error("GBB/1.0: Board size should be positive.");u.head=[0,0],u.board=[];for(var c=0;c<u.width;c++){for(var l=[],h=0;h<u.height;h++)l.push({a:0,n:0,r:0,v:0});u.board.push(l)}for(var f=!1,p={},_={Azul:"a",A:"a",Negro:"n",N:"n",Rojo:"r",R:"r",Verde:"v",V:"v"};s<t.length;){var m=i();if(""===m)break;if("head"===m){if(f)throw Error("GBB/1.0: Head position cannot be declared twice.");f=!0;var d=a(0,u.width,"GBB/1.0: Invalid head position."),y=a(0,u.height,"GBB/1.0: Invalid head position.");u.head=[d,y]}else{if("cell"!==m)throw Error('GBB/1.0: Malformed board: unknown command "'+m+'".');var v=a(0,u.width,"GBB/1.0: Invalid cell position."),g=a(0,u.height,"GBB/1.0: Invalid cell position.");if([v,g]in p)throw Error("GBB/1.0: Cell cannot be declared twice.");p[[v,g]]=!0;for(var b={};s<t.length;){var T=i();if(!(T in _)){s-=T.length;break}var S=_[T];if(S in b)throw Error("GBB/1.0: Color cannot be declared twice.");var P=o("GBB/1.0: Invalid amount of stones.");u.board[v][g][S]=P}}}return u}function l(t){var e=t.split(".");return e[e.length-1]}function h(t){var e=l(t),r=!0,n=!1,i=void 0;try{for(var o,a=d[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=o.value;if(e===s.extension)return s}}catch(t){n=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(n)throw i}}return v[y]}function f(t){var e=h(t),r=w.readFileSync(t,"utf8");return e.toJboard(r)}function p(t,e){var r=h(t),n=r.fromJboard(e);w.writeFileSync(t,n,"utf8")}Object.defineProperty(e,"__esModule",{value:!0});var _=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();e.apiboardFromJboard=i,e.apiboardToJboard=o,e.gbbFromJboard=u,e.gbbToJboard=c,e.readJboardFromFile=f,e.writeJboardToFile=p;var m=function(){function t(e,r,i,o,a){n(this,t),this._formatName=e,this._description=r,this._extension=i,this._fromJboard=o,this._toJboard=a}return _(t,[{key:"formatName",get:function(){return this._formatName}},{key:"description",get:function(){return this._description}},{key:"extension",get:function(){return this._extension}},{key:"fromJboard",get:function(){return this._fromJboard}},{key:"toJboard",get:function(){return this._toJboard}}]),t}(),d=[new m("jboard","Representation of a board as a JavaScript object for internal usage.","jboard",JSON.stringify,JSON.parse),new m("gs-weblang-cli-json-board","Representation of a board as a Javascript object used by the gs-weblang-cli tool.","json",a,s),new m("gbb","GBB/1.0","gbb",u,c)],y=e.DEFAULT_FORMAT="gs-weblang-cli-json-board",v=e.BOARD_FORMATS={},g=!0,b=!1,T=void 0;try{for(var S,P=d[Symbol.iterator]();!(g=(S=P.next()).done);g=!0){var k=S.value;v[k.formatName]=k}}catch(t){b=!0,T=t}finally{try{!g&&P.return&&P.return()}finally{if(b)throw T}}var w=r(18)},function(t,e){}])});